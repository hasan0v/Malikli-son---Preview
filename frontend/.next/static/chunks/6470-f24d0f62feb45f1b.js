"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6470],{167:(a,t,r)=>{r.d(t,{I1:()=>n,P_:()=>l,bulkAddToCart:()=>s,r5:()=>d,updateCartItemQuantity:()=>p,vI:()=>c,vM:()=>u,zA:()=>i});var e=r(6063),o=r(722);async function d(a,t){try{return(await o.A.post("/carts/".concat(a,"/items/"),t)).data}catch(a){return console.error("Error adding item to cart:",a),null}}async function i(){try{return(await o.A.post("/carts/",{})).data}catch(a){return console.error("Error creating cart:",a),null}}async function n(a){try{return(await o.A.post("/carts/sync/",a)).data.cart}catch(a){return console.error("Error syncing cart:",a),null}}async function c(a){try{return(await o.A.post("/carts/merge/",a)).data.cart}catch(a){return console.error("Error merging guest cart:",a),null}}async function l(a){try{let t={};return a&&(t["X-Cart-ID"]=a),(await o.A.get("/carts/mine/",{headers:t})).data}catch(a){var t;if((null==(t=a.response)?void 0:t.status)===404)return null;return console.error("Error fetching my cart:",a),null}}async function s(a,t){try{let r={};return t&&(r["X-Cart-ID"]=t),(await o.A.post("/carts/bulk-add/",{items:a},{headers:r})).data}catch(a){return console.error("Error bulk adding to cart:",a),null}}function u(a){return a.map(a=>(0,e.s)(a)).filter(a=>a.drop_product_id||a.product_variant_id)}async function p(a){try{let t={quantity:a.quantity,color:a.color,color_code:void 0,size:a.size};return a.variantId?t.product_variant_id=a.variantId:t.drop_product_id=a.itemId,await s([t])}catch(a){return console.error("Error updating cart item quantity:",a),null}}},722:(a,t,r)=>{r.d(t,{A:()=>o});let e=r(3464).A.create({baseURL:"http://localhost:8000/api/v1",headers:{"Content-Type":"application/json"}});e.interceptors.request.use(a=>{{let t=localStorage.getItem("access_token");t&&(a.headers.Authorization="Bearer ".concat(t))}return a},a=>(console.error("API Request Error:",a),Promise.reject(a))),e.interceptors.response.use(a=>a,a=>{var t;return a.response&&401===a.response.status&&console.error("Authentication error. Please login again."),console.error("API Response Error:",(null==(t=a.response)?void 0:t.data)||a.message),Promise.reject(a)});let o=e},4089:(a,t,r)=>{r.d(t,{Ay:()=>q,Bb:()=>w,RO:()=>h,So:()=>s,dt:()=>f,sL:()=>u,sX:()=>C,tA:()=>p,u$:()=>z});var e=r(1990),o=r(167),d=r(6063);let i=()=>{try{let a=localStorage.getItem("cart");return a?JSON.parse(a):[]}catch(a){return console.error("Error loading cart from localStorage:",a),[]}},n=a=>{try{localStorage.setItem("cart",JSON.stringify(a))}catch(a){console.error("Error saving cart to localStorage:",a)}},c=()=>{try{return localStorage.getItem("cartId")||void 0}catch(a){console.error("Error loading cart ID from localStorage:",a);return}},l=a=>{try{a?localStorage.setItem("cartId",a):localStorage.removeItem("cartId")}catch(a){console.error("Error saving cart ID to localStorage:",a)}},s=(0,e.zD)("cart/syncWithBackend",async(a,t)=>{let{getState:r,rejectWithValue:e}=t;try{let a=r(),t=(0,o.vM)(a.cart.items),e=a.cart.cartId,d=await (0,o.I1)({items:t,guest_cart_id:e});if(!d)throw Error("Failed to sync cart with backend");return d}catch(a){return e(a.message||"Failed to sync cart")}}),u=(0,e.zD)("cart/mergeGuestCart",async(a,t)=>{let{guestCartId:r,strategy:e}=a,{rejectWithValue:d}=t;try{let a=await (0,o.vI)({guest_cart_id:r,merge_strategy:e});if(!a)throw Error("Failed to merge guest cart");return a}catch(a){return d(a.message||"Failed to merge cart")}}),p=(0,e.zD)("cart/loadFromBackend",async function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{rejectWithValue:t}=arguments.length>1?arguments[1]:void 0;try{return await (0,o.P_)(a.guestCartId)}catch(a){return t(a.message||"Failed to load cart from backend")}}),y=(0,e.zD)("cart/bulkAddToUserCart",async(a,t)=>{let{getState:e,rejectWithValue:d}=t;try{let a=e(),{bulkAddToCart:t}=await Promise.resolve().then(r.bind(r,167)),d=(0,o.vM)(a.cart.items);if(0===d.length)return null;let i=await t(d);if(!i)throw Error("Failed to bulk add items to cart");return i}catch(a){return d(a.message||"Failed to bulk add items to cart")}}),m=(0,e.zD)("cart/addToCartAPI",async(a,t)=>{let{getState:e,rejectWithValue:o}=t;try{let t=e(),{bulkAddToCart:o}=await Promise.resolve().then(r.bind(r,167)),i=[(0,d.s)(a)].filter(a=>a.drop_product_id||a.product_variant_id);if(0===i.length)throw Error("Invalid item to add to cart");let n=await o(i,t.cart.cartId);if(!n)throw Error("Failed to add item to cart");return n}catch(a){return o(a.message||"Failed to add item to cart")}}),_=(0,e.zD)("cart/updateCartItemQuantityAPI",async(a,t)=>{let{getState:e,rejectWithValue:o}=t;try{e();let{updateCartItemQuantity:t}=await Promise.resolve().then(r.bind(r,167)),o=await t({itemId:a.id,variantId:a.variantId,color:a.color,size:a.size,quantity:a.quantity});if(!o)throw Error("Failed to update cart item quantity");return o}catch(a){return o(a.message||"Failed to update cart item quantity")}}),g={items:i(),cartId:c(),isLoading:!1,needsSync:!1,lastSyncTime:void 0},v=(0,e.Z0)({name:"cart",initialState:g,reducers:{addToCart:(a,t)=>{let r=a.items.find(a=>a.id===t.payload.id&&a.variantId===t.payload.variantId&&a.color===t.payload.color&&a.size===t.payload.size);r?r.quantity+=t.payload.quantity||1:a.items.push(t.payload),n(a.items),a.needsSync=!0},removeFromCart:(a,t)=>{a.items=a.items.filter(a=>a.id!==t.payload.id||a.variantId!==t.payload.variantId||a.color!==t.payload.color||a.size!==t.payload.size),n(a.items),a.needsSync=!0},updateQuantity:(a,t)=>{let r=a.items.find(a=>a.id===t.payload.id&&a.variantId===t.payload.variantId&&a.color===t.payload.color&&a.size===t.payload.size);r&&(r.quantity=Math.max(1,Math.floor(t.payload.quantity))),n(a.items),a.needsSync=!0},clearCart:a=>{a.items=[],a.needsSync=!1,n([])},loadCart:a=>{a.items=i(),a.cartId=c()},setCartId:(a,t)=>{a.cartId=t.payload,l(t.payload)},markAsSynced:a=>{a.needsSync=!1,a.lastSyncTime=Date.now()},setCartFromBackend:(a,t)=>{a.items=t.payload.items.map(a=>(0,d.E)(a)),a.cartId=t.payload.cart_id,a.needsSync=!1,a.lastSyncTime=Date.now(),n(a.items),l(t.payload.cart_id)}},extraReducers:a=>{a.addCase(s.pending,a=>{a.isLoading=!0,a.error=void 0}).addCase(s.fulfilled,(a,t)=>{a.isLoading=!1,a.needsSync=!1,a.lastSyncTime=Date.now(),t.payload.cart_id&&(a.cartId=t.payload.cart_id,l(t.payload.cart_id))}).addCase(s.rejected,(a,t)=>{a.isLoading=!1,a.error=t.payload}),a.addCase(u.pending,a=>{a.isLoading=!0,a.error=void 0}).addCase(u.fulfilled,(a,t)=>{a.isLoading=!1,a.needsSync=!1,a.lastSyncTime=Date.now(),a.items=t.payload.items.map(a=>(0,d.E)(a)),a.cartId=t.payload.cart_id,n(a.items),l(t.payload.cart_id)}).addCase(u.rejected,(a,t)=>{a.isLoading=!1,a.error=t.payload}),a.addCase(p.pending,a=>{a.isLoading=!0,a.error=void 0}).addCase(p.fulfilled,(a,t)=>{a.isLoading=!1,t.payload&&(a.items=t.payload.items.map(a=>(0,d.E)(a)),t.payload.cart_id&&(a.cartId=t.payload.cart_id,l(t.payload.cart_id)),a.needsSync=!1,a.lastSyncTime=Date.now(),n(a.items))}).addCase(p.rejected,(a,t)=>{a.isLoading=!1,a.error=t.payload}),a.addCase(y.pending,a=>{a.isLoading=!0,a.error=void 0}).addCase(y.fulfilled,(a,t)=>{a.isLoading=!1,a.needsSync=!1,a.lastSyncTime=Date.now(),t.payload&&(a.items=t.payload.items.map(a=>(0,d.E)(a)),t.payload.cart_id&&(a.cartId=t.payload.cart_id,l(t.payload.cart_id)),n(a.items))}).addCase(y.rejected,(a,t)=>{a.isLoading=!1,a.error=t.payload}),a.addCase(m.pending,a=>{a.isLoading=!0,a.error=void 0}).addCase(m.fulfilled,(a,t)=>{a.isLoading=!1,a.needsSync=!1,a.lastSyncTime=Date.now(),t.payload&&(a.items=t.payload.items.map(a=>(0,d.E)(a)),t.payload.cart_id&&(a.cartId=t.payload.cart_id,l(t.payload.cart_id)),n(a.items))}).addCase(m.rejected,(a,t)=>{a.isLoading=!1,a.error=t.payload}).addCase(_.pending,a=>{a.isLoading=!0,a.error=void 0}).addCase(_.fulfilled,(a,t)=>{a.isLoading=!1,a.needsSync=!1,a.lastSyncTime=Date.now(),t.payload&&(a.items=t.payload.items.map(a=>(0,d.E)(a)),t.payload.cart_id&&(a.cartId=t.payload.cart_id,l(t.payload.cart_id)),n(a.items))}).addCase(_.rejected,(a,t)=>{a.isLoading=!1,a.error=t.payload})}}),{addToCart:I,removeFromCart:f,updateQuantity:h,clearCart:C,loadCart:w,setCartId:S,markAsSynced:z,setCartFromBackend:E}=v.actions,q=v.reducer},6063:(a,t,r)=>{function e(a){var t,r,e,o,d,i,n,c,l,s,u,p;let y,m,_,g,v;if(a.drop_product_details?y={name:a.drop_product_details.product.name,basePrice:a.drop_product_details.product.base_price}:(null==(t=a.product_variant_details)?void 0:t.product_details)&&(y={name:a.product_variant_details.product_details.name,basePrice:parseFloat(a.product_variant_details.product_details.base_price)}),null==(r=a.product_variant_details)?void 0:r.image)m=a.product_variant_details.image;else if((null==(e=a.product_variant_details)?void 0:e.images)&&a.product_variant_details.images.length>0){let t=a.product_variant_details.images.find(a=>a.is_primary);m=t?t.image:a.product_variant_details.images[0].image}else if((null==(d=a.product_variant_details)||null==(o=d.product_details)?void 0:o.images)&&a.product_variant_details.product_details.images.length>0){let t=a.product_variant_details.product_details.images.find(a=>a.is_primary);m=t?t.image:a.product_variant_details.product_details.images[0].image}else(null==(i=a.drop_product_details)?void 0:i.image)&&(m=a.drop_product_details.image);return a.color?_=a.color:(null==(c=a.product_variant_details)||null==(n=c.color_info)?void 0:n.name)&&(_=a.product_variant_details.color_info.name),a.color_code?g=a.color_code:(null==(s=a.product_variant_details)||null==(l=s.color_info)?void 0:l.hex_code)&&(g=a.product_variant_details.color_info.hex_code),a.size?v=a.size:(null==(p=a.product_variant_details)||null==(u=p.size_info)?void 0:u.name)&&(v=a.product_variant_details.size_info.name),{id:a.drop_product||a.product_variant||a.id,variantId:a.product_variant||void 0,dropProductId:a.drop_product||void 0,isDropProduct:!!a.drop_product,name:(null==y?void 0:y.name)||"Unknown Product",price:a.unit_price,quantity:a.quantity,image:m,color:_,colorCode:g,size:v}}function o(a){return a.isDropProduct||a.dropProductId?{drop_product_id:a.dropProductId||a.id,quantity:a.quantity,color:a.color||void 0,color_code:a.colorCode||void 0,size:a.size||void 0}:a.variantId?{product_variant_id:a.variantId,quantity:a.quantity,color:a.color||void 0,color_code:a.colorCode||void 0,size:a.size||void 0}:(console.warn("Product without variant ID found in cart:",a),{quantity:a.quantity,color:a.color||void 0,color_code:a.colorCode||void 0,size:a.size||void 0})}r.d(t,{E:()=>e,s:()=>o})}}]);