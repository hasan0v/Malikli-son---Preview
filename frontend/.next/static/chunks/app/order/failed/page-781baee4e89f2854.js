(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4163],{5695:(e,r,a)=>{"use strict";var s=a(8999);a.o(s,"useParams")&&a.d(r,{useParams:function(){return s.useParams}}),a.o(s,"usePathname")&&a.d(r,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(r,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(r,{useSearchParams:function(){return s.useSearchParams}})},5977:(e,r,a)=>{Promise.resolve().then(a.bind(a,8929))},6135:e=>{e.exports={failedPage:"orderFailed_failedPage__pbbCu",container:"orderFailed_container__eH3Mk",loadingState:"orderFailed_loadingState__Es11V",spinner:"orderFailed_spinner__w43Kg",spin:"orderFailed_spin__1UL6W",failureState:"orderFailed_failureState__hwkk3",failureIcon:"orderFailed_failureIcon__1aBU9",failureTitle:"orderFailed_failureTitle__FgsCj",failureMessage:"orderFailed_failureMessage__OXI7u",reasonBox:"orderFailed_reasonBox__1x9HI",reasonTitle:"orderFailed_reasonTitle__pJp08",reasonText:"orderFailed_reasonText__HqOC7",orderInfo:"orderFailed_orderInfo__6j95A",infoTitle:"orderFailed_infoTitle__BAJwa",infoGrid:"orderFailed_infoGrid__syPxN",infoItem:"orderFailed_infoItem__xgB6U",label:"orderFailed_label__fkFQ6",value:"orderFailed_value__HW5Ei",statusFailed:"orderFailed_statusFailed__5p_bL",paymentFailed:"orderFailed_paymentFailed__L0EPd",nextSteps:"orderFailed_nextSteps__nNs5z",nextStepsTitle:"orderFailed_nextStepsTitle__oH42R",stepsList:"orderFailed_stepsList__bD7Dk",commonIssues:"orderFailed_commonIssues__FyxUA",issuesTitle:"orderFailed_issuesTitle__tUnHx",issuesList:"orderFailed_issuesList__SNXOB",issue:"orderFailed_issue__KfJzs",actions:"orderFailed_actions__sfzSE",primaryButton:"orderFailed_primaryButton__njV23",secondaryButton:"orderFailed_secondaryButton__RJP2q",tertiaryButton:"orderFailed_tertiaryButton__Tu14W"}},8929:(e,r,a)=>{"use strict";a.r(r),a.d(r,{default:()=>u});var s=a(5155),t=a(2115),o=a(5695),n=a(4540),i=a(5295),d=a(9493),l=a(6135),c=a.n(l);function u(){let e,{t:r}=(0,i.useI18n)(),a=(0,o.useRouter)(),l=(0,o.useSearchParams)(),{isAuthenticated:u}=(0,n.d4)(e=>e.auth),[_,p]=(0,t.useState)(null),[m,h]=(0,t.useState)(!0),[f,g]=(0,t.useState)(null),x=null==l?void 0:l.get("orderId"),j=null==l?void 0:l.get("reason");(0,t.useEffect)(()=>{let e=async()=>{if(!x){g("Order ID not found"),h(!1);return}try{let e=localStorage.getItem("access_token");if(!e){g("Authentication required"),h(!1);return}let r=await (0,d.p)(x,e);p(r)}catch(e){console.error("Failed to load order:",e),g(e instanceof Error?e.message:"Failed to load order details")}finally{h(!1)}};u?e():h(!1)},[x,u]);if(m)return(0,s.jsx)("div",{className:c().failedPage,children:(0,s.jsx)("div",{className:c().container,children:(0,s.jsxs)("div",{className:c().loadingState,children:[(0,s.jsx)("div",{className:c().spinner}),(0,s.jsx)("p",{children:r("orderFailed.loading")})]})})});return(0,s.jsx)("div",{className:c().failedPage,children:(0,s.jsx)("div",{className:c().container,children:(0,s.jsxs)("div",{className:c().failureState,children:[(0,s.jsx)("div",{className:c().failureIcon,children:(0,s.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("circle",{cx:"12",cy:"12",r:"10",fill:"#EF4444"}),(0,s.jsx)("path",{d:"m15 9-6 6m0-6 6 6",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}),(0,s.jsx)("h1",{className:c().failureTitle,children:r("orderFailed.title")}),(0,s.jsx)("p",{className:c().failureMessage,children:r("orderFailed.message")}),j&&(0,s.jsxs)("div",{className:c().reasonBox,children:[(0,s.jsx)("h3",{className:c().reasonTitle,children:r("orderFailed.reason.title")}),(0,s.jsx)("p",{className:c().reasonText,children:decodeURIComponent(j)})]}),_&&(0,s.jsxs)("div",{className:c().orderInfo,children:[(0,s.jsx)("h2",{className:c().infoTitle,children:r("orderFailed.orderInfo.title")}),(0,s.jsxs)("div",{className:c().infoGrid,children:[(0,s.jsxs)("div",{className:c().infoItem,children:[(0,s.jsxs)("span",{className:c().label,children:[r("orderFailed.orderInfo.orderNumber"),":"]}),(0,s.jsx)("span",{className:c().value,children:_.order_number})]}),(0,s.jsxs)("div",{className:c().infoItem,children:[(0,s.jsxs)("span",{className:c().label,children:[r("orderFailed.orderInfo.amount"),":"]}),(0,s.jsxs)("span",{className:c().value,children:["$",("string"==typeof(e=_.total_amount)?parseFloat(e):e).toFixed(2)]})]}),(0,s.jsxs)("div",{className:c().infoItem,children:[(0,s.jsxs)("span",{className:c().label,children:[r("orderFailed.orderInfo.status"),":"]}),(0,s.jsx)("span",{className:"".concat(c().value," ").concat(c().statusFailed),children:r("orders.status.".concat(_.status))})]}),(0,s.jsxs)("div",{className:c().infoItem,children:[(0,s.jsxs)("span",{className:c().label,children:[r("orderFailed.orderInfo.paymentStatus"),":"]}),(0,s.jsx)("span",{className:"".concat(c().value," ").concat(c().paymentFailed),children:r("orders.paymentStatus.".concat(_.payment_status))})]})]})]}),(0,s.jsxs)("div",{className:c().nextSteps,children:[(0,s.jsx)("h3",{className:c().nextStepsTitle,children:r("orderFailed.nextSteps.title")}),(0,s.jsxs)("ul",{className:c().stepsList,children:[(0,s.jsx)("li",{children:r("orderFailed.nextSteps.checkPayment")}),(0,s.jsx)("li",{children:r("orderFailed.nextSteps.tryAgain")}),(0,s.jsx)("li",{children:r("orderFailed.nextSteps.differentMethod")}),(0,s.jsx)("li",{children:r("orderFailed.nextSteps.contactSupport")})]})]}),(0,s.jsxs)("div",{className:c().commonIssues,children:[(0,s.jsx)("h3",{className:c().issuesTitle,children:r("orderFailed.commonIssues.title")}),(0,s.jsxs)("div",{className:c().issuesList,children:[(0,s.jsxs)("div",{className:c().issue,children:[(0,s.jsx)("h4",{children:r("orderFailed.commonIssues.insufficientFunds.title")}),(0,s.jsx)("p",{children:r("orderFailed.commonIssues.insufficientFunds.description")})]}),(0,s.jsxs)("div",{className:c().issue,children:[(0,s.jsx)("h4",{children:r("orderFailed.commonIssues.cardExpired.title")}),(0,s.jsx)("p",{children:r("orderFailed.commonIssues.cardExpired.description")})]}),(0,s.jsxs)("div",{className:c().issue,children:[(0,s.jsx)("h4",{children:r("orderFailed.commonIssues.networkError.title")}),(0,s.jsx)("p",{children:r("orderFailed.commonIssues.networkError.description")})]})]})]}),(0,s.jsxs)("div",{className:c().actions,children:[(0,s.jsx)("button",{onClick:()=>{_?a.push("/checkout"):a.push("/cart")},className:c().primaryButton,children:r("orderFailed.actions.tryAgain")}),(0,s.jsx)("button",{onClick:()=>{a.push("/contact")},className:c().secondaryButton,children:r("orderFailed.actions.contactSupport")}),(0,s.jsx)("button",{onClick:()=>{a.push("/orders")},className:c().tertiaryButton,children:r("orderFailed.actions.viewOrders")})]})]})})})}},9493:(e,r,a)=>{"use strict";a.d(r,{FK:()=>t,It:()=>n,N4:()=>d,fS:()=>o,mK:()=>_,p:()=>i,u:()=>l});let s="http://localhost:8000/api/v1";async function t(e,r){let a=new URL("".concat(s,"/orders/"));r&&(r.status&&"all"!==r.status&&a.searchParams.append("status",r.status),r.ordering&&a.searchParams.append("ordering",r.ordering),r.page&&a.searchParams.append("page",r.page.toString()),r.page_size&&a.searchParams.append("page_size",r.page_size.toString()));let t=await fetch(a.toString(),{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!t.ok){if(401===t.status)throw Error("Unauthorized - please log in again");throw Error("Failed to fetch orders: ".concat(t.statusText))}let o=await t.json();return{...o,results:o.results.map(u)}}async function o(e,r){console.log("=== CREATE ORDER API CALLED ==="),console.log("API URL:","".concat(s,"/orders/create/")),console.log("Order data:",e),console.log("Token available:",!!r);let a=await fetch("".concat(s,"/orders/create/"),{method:"POST",headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"},body:JSON.stringify(e)});if(console.log("=== CREATE ORDER RESPONSE ==="),console.log("Status:",a.status),console.log("Status text:",a.statusText),console.log("Response OK:",a.ok),!a.ok){let e=await a.json();throw console.error("=== CREATE ORDER ERROR RESPONSE ==="),console.error("Error data:",e),Error(e.message||"Failed to create order")}let t=await a.json();console.log("=== CREATE ORDER SUCCESS ==="),console.log("Backend order response:",t);let o=u(t);return console.log("Transformed order:",o),o}async function n(e,r,a){let t={"Content-Type":"application/json"};a&&(t.Authorization="Bearer ".concat(a));let o=await fetch("".concat(s,"/orders/payment-callback/"),{method:"POST",headers:t,body:JSON.stringify({uid:e,status:"paid"===r?"success":"failed"})});if(!o.ok)throw Error((await o.json()).message||"Failed to update order payment status");if((await o.json()).success&&a)return i(String(e),a);throw Error("Payment status update failed")}async function i(e,r){let a=await fetch("".concat(s,"/orders/").concat(e,"/"),{method:"GET",headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"}});if(!a.ok){if(401===a.status)throw Error("Unauthorized - please log in again");if(404===a.status)throw Error("Order not found");throw Error("Failed to fetch order: ".concat(a.statusText))}return u(await a.json())}async function d(e,r){let a=await fetch("".concat(s,"/orders/").concat(e,"/cancel/"),{method:"POST",headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"}});if(!a.ok){if(401===a.status)throw Error("Unauthorized - please log in again");if(404===a.status)throw Error("Order not found");if(400===a.status)throw Error((await a.json()).detail||"Cannot cancel this order");throw Error("Failed to cancel order: ".concat(a.statusText))}return u(await a.json())}async function l(e,r){let a=await fetch("".concat(s,"/orders/").concat(e,"/reorder/"),{method:"POST",headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"}});if(!a.ok){if(401===a.status)throw Error("Unauthorized - please log in again");if(404===a.status)throw Error("Order not found");if(400===a.status)throw Error((await a.json()).detail||"Cannot reorder these items");throw Error("Failed to reorder items: ".concat(a.statusText))}return a.json()}function c(e){return{id:e.id,product_id:e.product_id,variant_id:e.variant_id,product_name:e.product_name,variant_name:e.variant_name,product_image:e.product_image,product_slug:e.product_slug,price:e.price,quantity:e.quantity,color:e.color,size:e.size,subtotal:e.subtotal,sku_snapshot:e.sku_snapshot,name:e.product_name,image:e.product_image||"/placeholder-product.png",variant:e.variant_name}}function u(e){var r,a,s,t,o,n;console.log("Transforming backend order:",e);let i=e.shipping_address_details||e.shipping_address||{};return console.log("Shipping address details:",i),console.log("User fields from backend:",{user_first_name:e.user_first_name,user_last_name:e.user_last_name,user_email:e.user_email,user_phone:e.user_phone,email_for_guest:e.email_for_guest}),{id:e.order_id||e.id,order_number:e.order_number,status:({pending_payment:"pending",processing:"processing",shipped:"shipped",delivered:"delivered",cancelled:"cancelled",refunded:"cancelled",failed:"cancelled"})[e.order_status]||"pending",payment_status:({pending:"pending",paid:"paid",failed:"failed",refunded_partial:"refunded",refunded_full:"refunded"})[e.payment_status]||"pending",created_at:e.created_at,updated_at:e.updated_at,total_amount:e.total_amount,shipping_cost:e.shipping_cost,discount_amount:e.discount_amount,subtotal_amount:e.subtotal_amount,items:(null==(r=e.items)?void 0:r.map(c))||[],shipping_address:{first_name:(null==(a=i.recipient_name)?void 0:a.split(" ")[0])||i.first_name||"",last_name:(null==(s=i.recipient_name)?void 0:s.split(" ").slice(1).join(" "))||i.last_name||"",street_address:i.street_address||i.address_line_1||"",city:i.city||"",state:i.state_province||i.state||i.region||"",postal_code:i.postal_code||i.zip_code||"",country:i.country_code||i.country||"",phone:i.phone_number||i.phone||""},shipping_method:(null==(t=e.shipping_method_details)?void 0:t.name)||e.shipping_method||"Standard",shipping_method_details:e.shipping_method_details,tracking_number:e.tracking_number,estimated_delivery:e.estimated_delivery,customer_info:{first_name:e.user_first_name||(null==(o=i.recipient_name)?void 0:o.split(" ")[0])||"",last_name:e.user_last_name||(null==(n=i.recipient_name)?void 0:n.split(" ").slice(1).join(" "))||"",email:e.user_email||e.email_for_guest||"",phone:e.user_phone||i.phone_number||""}}}async function _(e,r){console.log("=== CREATE DIRECT ORDER API CALLED ==="),console.log("API URL:","".concat(s,"/orders/create-direct/")),console.log("Order data:",e),console.log("Token available:",!!r);let a={"Content-Type":"application/json"};r&&(a.Authorization="Bearer ".concat(r));let t=await fetch("".concat(s,"/orders/create-direct/"),{method:"POST",headers:a,body:JSON.stringify(e)});if(console.log("=== CREATE DIRECT ORDER RESPONSE ==="),console.log("Status:",t.status),console.log("Status text:",t.statusText),console.log("Response OK:",t.ok),!t.ok){let e=await t.json();throw console.error("=== CREATE DIRECT ORDER ERROR RESPONSE ==="),console.error("Error data:",e),Error(e.message||"Failed to create direct order")}let o=await t.json();console.log("=== CREATE DIRECT ORDER SUCCESS ==="),console.log("Backend order response:",o);let n=u(o);return console.log("Transformed direct order:",n),n}}},e=>{var r=r=>e(e.s=r);e.O(0,[1936,4540,5295,8441,1684,7358],()=>r(5977)),_N_E=e.O()}]);