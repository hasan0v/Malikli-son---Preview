(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6168],{4502:(e,a,r)=>{"use strict";r.r(a),r.d(a,{default:()=>d});var s=r(5155),t=r(2115),c=r(5695),n=r(171);async function l(e){let a=await fetch("".concat("http://localhost:8000/api/v1","/orders/payment-callback/"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!a.ok){let e=await a.text();console.error("Payment callback failed:",{status:a.status,statusText:a.statusText,response:e});let r="Payment callback failed: ".concat(a.statusText);try{r=JSON.parse(e).message||r}catch(e){}throw Error(r)}return a.json()}var o=r(5108),i=r.n(o);function d(){let{t:e}=(0,n.useI18n)(),a=(0,c.useRouter)(),r=(0,c.useSearchParams)(),[o,d]=(0,t.useState)(!0),[p,m]=(0,t.useState)(null);return((0,t.useEffect)(()=>{let e=async()=>{try{let e=function(e){let a=e.get("status"),r=e.get("token"),s=e.get("uid");return a?"success"!==a&&"failed"!==a?{isValid:!1,error:"Invalid status parameter"}:s?{isValid:!0,status:a,token:r||void 0,uid:s}:{isValid:!1,error:"Missing uid parameter"}:{isValid:!1,error:"Missing status parameter"}}(r);if(!e.isValid)throw Error(e.error||"Invalid callback parameters");let{status:s,token:t,uid:c}=e,n=await l({status:s,token:t,uid:c});"success"===s?a.replace("/order/complete?orderId=".concat(n.orderId)):a.replace("/order/failed?orderId=".concat(n.orderId,"&reason=").concat(encodeURIComponent(n.reason||"Payment failed")))}catch(e){console.error("Payment callback error:",e),m(e instanceof Error?e.message:"An unexpected error occurred"),d(!1)}};r&&e()},[r,a]),p)?(0,s.jsx)("div",{className:i().callbackPage,children:(0,s.jsx)("div",{className:i().container,children:(0,s.jsxs)("div",{className:i().errorState,children:[(0,s.jsx)("div",{className:i().errorIcon,children:"⚠️"}),(0,s.jsx)("h1",{className:i().errorTitle,children:e("paymentCallback.error.title")}),(0,s.jsx)("p",{className:i().errorMessage,children:p}),(0,s.jsxs)("div",{className:i().actions,children:[(0,s.jsx)("button",{onClick:()=>a.push("/orders"),className:i().primaryButton,children:e("paymentCallback.error.viewOrders")}),(0,s.jsx)("button",{onClick:()=>a.push("/"),className:i().secondaryButton,children:e("paymentCallback.error.backHome")})]})]})})}):(0,s.jsx)("div",{className:i().callbackPage,children:(0,s.jsx)("div",{className:i().container,children:(0,s.jsxs)("div",{className:i().processingState,children:[(0,s.jsx)("div",{className:i().spinner}),(0,s.jsx)("h1",{className:i().processingTitle,children:e("paymentCallback.processing.title")}),(0,s.jsx)("p",{className:i().processingMessage,children:e("paymentCallback.processing.message")})]})})})}},5108:e=>{e.exports={callbackPage:"paymentCallback_callbackPage__whMhp",container:"paymentCallback_container__afabW",processingState:"paymentCallback_processingState__aqFhy",spinner:"paymentCallback_spinner__fA53y",spin:"paymentCallback_spin__JGQQ3",processingTitle:"paymentCallback_processingTitle__m5O4d",processingMessage:"paymentCallback_processingMessage__rXt6B",errorState:"paymentCallback_errorState___kW0E",errorIcon:"paymentCallback_errorIcon__W7dGB",errorTitle:"paymentCallback_errorTitle__fC4Yn",errorMessage:"paymentCallback_errorMessage__4Ev1R",actions:"paymentCallback_actions__sD2pu",primaryButton:"paymentCallback_primaryButton__GRQlK",secondaryButton:"paymentCallback_secondaryButton__jYli5"}},5414:(e,a,r)=>{Promise.resolve().then(r.bind(r,4502))}},e=>{var a=a=>e(e.s=a);e.O(0,[3355,6707,9800,2352,6530,2214,5748,2333,8187,5980,4676,7698,1659,8538,3516,901,9857,8268,4170,7635,9670,7593,6861,5885,7128,6136,9064,3743,5377,1980,4297,2868,4681,4833,6986,9002,9466,7692,6451,6373,8852,8096,7358],()=>a(5414)),_N_E=e.O()}]);