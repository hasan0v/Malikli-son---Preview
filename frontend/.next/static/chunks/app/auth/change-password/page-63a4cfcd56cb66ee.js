(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2796],{22:(s,e,a)=>{"use strict";a.r(e),a.d(e,{default:()=>m});var r=a(5155),o=a(2115),n=a(5695),l=a(6874),d=a.n(l),t=a(2045),c=a(171),i=a(6866),h=a(5910),w=a.n(h);function m(){let{t:s}=(0,c.useI18n)(),[e,a]=(0,o.useState)({oldPassword:"",newPassword:"",confirmPassword:""}),[l,h]=(0,o.useState)(!1),[m,u]=(0,o.useState)(!1),[p,x]=(0,o.useState)(!1),[j,N]=(0,o.useState)({}),[P,f]=(0,o.useState)(!1),[v,b]=(0,o.useState)(!1),g=(0,n.useRouter)(),{user:y,token:C}=(0,t.G)(s=>s.auth);if(!y||!C)return g.push("/auth/login"),null;let _=()=>{let s={};return e.oldPassword||(s.oldPassword="Текущий пароль обязателен"),e.newPassword?e.newPassword.length<8&&(s.newPassword="Пароль должен содержать минимум 8 символов"):s.newPassword="Новый пароль обязателен",e.confirmPassword?e.newPassword!==e.confirmPassword&&(s.confirmPassword="Пароли не совпадают"):s.confirmPassword="Подтвердите новый пароль",N(s),0===Object.keys(s).length},k=async s=>{if(s.preventDefault(),_()){b(!0),N({});try{let s=await fetch("".concat(i.JR,"/auth/change-password/"),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(C)},body:JSON.stringify({old_password:e.oldPassword,new_password:e.newPassword,new_password2:e.confirmPassword})});if(s.ok)f(!0),a({oldPassword:"",newPassword:"",confirmPassword:""});else{let e=await s.json();N(e)}}catch(s){N({general:"Ошибка сети. Попробуйте позже."})}finally{b(!1)}}},T=s=>{let{name:r,value:o}=s.target;a({...e,[r]:o}),j[r]&&N({...j,[r]:""})};return P?(0,r.jsx)("div",{className:w().authContainer,children:(0,r.jsxs)("div",{className:w().authCard,children:[(0,r.jsxs)("div",{className:w().authHeader,children:[(0,r.jsx)("h1",{className:w().authTitle,children:"Пароль изменен"}),(0,r.jsx)("p",{className:w().authSubtitle,children:"Ваш пароль был успешно изменен"})]}),(0,r.jsxs)("div",{className:w().successMessage,children:[(0,r.jsx)("div",{className:w().successIcon,children:"✓"}),(0,r.jsx)("p",{children:"Пароль обновлен. Пожалуйста, используйте новый пароль при следующем входе."})]}),(0,r.jsxs)("div",{className:w().authFooter,children:[(0,r.jsx)(d(),{href:"/profile",className:w().linkButton,children:"Вернуться в профиль"}),(0,r.jsx)(d(),{href:"/",className:w().authLink,children:"На главную"})]})]})}):(0,r.jsx)("div",{className:w().authContainer,children:(0,r.jsxs)("div",{className:w().authCard,children:[(0,r.jsxs)("div",{className:w().authHeader,children:[(0,r.jsx)("h1",{className:w().authTitle,children:"Изменить пароль"}),(0,r.jsx)("p",{className:w().authSubtitle,children:"Введите текущий пароль и новый пароль"})]}),(0,r.jsxs)("form",{onSubmit:k,className:w().authForm,children:[j.general&&(0,r.jsx)("div",{className:w().errorMessage,children:j.general}),(0,r.jsxs)("div",{className:w().formGroup,children:[(0,r.jsx)("label",{htmlFor:"oldPassword",className:w().formLabel,children:"Текущий пароль"}),(0,r.jsxs)("div",{className:w().passwordWrapper,children:[(0,r.jsx)("input",{type:l?"text":"password",id:"oldPassword",name:"oldPassword",value:e.oldPassword,onChange:T,className:"".concat(w().formInput," ").concat(j.oldPassword?w().inputError:""),placeholder:"Введите текущий пароль",required:!0}),(0,r.jsx)("button",{type:"button",className:w().passwordToggle,onClick:()=>h(!l),children:l?"\uD83D\uDE48":"\uD83D\uDC41️"})]}),j.oldPassword&&(0,r.jsx)("span",{className:w().errorText,children:j.oldPassword}),j.old_password&&(0,r.jsx)("span",{className:w().errorText,children:j.old_password})]}),(0,r.jsxs)("div",{className:w().formGroup,children:[(0,r.jsx)("label",{htmlFor:"newPassword",className:w().formLabel,children:"Новый пароль"}),(0,r.jsxs)("div",{className:w().passwordWrapper,children:[(0,r.jsx)("input",{type:m?"text":"password",id:"newPassword",name:"newPassword",value:e.newPassword,onChange:T,className:"".concat(w().formInput," ").concat(j.newPassword?w().inputError:""),placeholder:"Введите новый пароль",required:!0}),(0,r.jsx)("button",{type:"button",className:w().passwordToggle,onClick:()=>u(!m),children:m?"\uD83D\uDE48":"\uD83D\uDC41️"})]}),j.newPassword&&(0,r.jsx)("span",{className:w().errorText,children:j.newPassword}),j.new_password&&(0,r.jsx)("span",{className:w().errorText,children:j.new_password})]}),(0,r.jsxs)("div",{className:w().formGroup,children:[(0,r.jsx)("label",{htmlFor:"confirmPassword",className:w().formLabel,children:"Подтвердите новый пароль"}),(0,r.jsxs)("div",{className:w().passwordWrapper,children:[(0,r.jsx)("input",{type:p?"text":"password",id:"confirmPassword",name:"confirmPassword",value:e.confirmPassword,onChange:T,className:"".concat(w().formInput," ").concat(j.confirmPassword?w().inputError:""),placeholder:"Подтвердите новый пароль",required:!0}),(0,r.jsx)("button",{type:"button",className:w().passwordToggle,onClick:()=>x(!p),children:p?"\uD83D\uDE48":"\uD83D\uDC41️"})]}),j.confirmPassword&&(0,r.jsx)("span",{className:w().errorText,children:j.confirmPassword})]}),(0,r.jsx)("button",{type:"submit",disabled:v,className:"".concat(w().authButton," ").concat(w().primaryButton),children:v?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:w().spinner}),"Сохранение..."]}):"Изменить пароль"})]}),(0,r.jsx)("div",{className:w().authFooter,children:(0,r.jsx)(d(),{href:"/profile",className:w().authLink,children:"Отмена"})})]})})}},2696:(s,e,a)=>{Promise.resolve().then(a.bind(a,22))}},s=>{var e=e=>s(s.s=e);s.O(0,[9614,5829,6707,9800,2352,6530,2214,5748,2333,8187,5980,4676,7698,1659,8538,3516,901,9857,8268,4170,7635,9670,7593,6861,5885,7128,6136,9064,3743,5377,1980,7137,1880,4297,2868,4681,4833,6986,9717,6886,7692,6451,6373,8852,8096,7358],()=>e(2696)),_N_E=s.O()}]);