(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6040],{2810:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>m});var t=a(5155),r=a(2115),o=a(4540),n=a(5695),i=a(5295),l=a(9493),d=a(4153),c=a.n(d);function m(){var e,s,a,d,m,u;let{t:_}=(0,i.useI18n)(),p=(0,n.useRouter)(),h=(0,n.useParams)(),{isAuthenticated:g,user:f}=(0,o.d4)(e=>e.auth),[j,v]=(0,r.useState)(null),[x,N]=(0,r.useState)(!0),[D,y]=(0,r.useState)(null),[I,E]=(0,r.useState)(!1),k=null==h?void 0:h.id;(0,r.useEffect)(()=>{(()=>{let e=localStorage.getItem("access_token");if(e&&!g&&!I)return setTimeout(()=>{E(!0)},100);if(!e&&!g){let e=window.location.pathname;p.push("/auth/login?redirect=".concat(encodeURIComponent(e)));return}E(!0)})()},[g,I,p]),(0,r.useEffect)(()=>{let e=async()=>{if(!k||!I){y("Invalid order ID"),N(!1);return}let e=localStorage.getItem("access_token");if(!g&&!e){y("Not authenticated"),N(!1);return}N(!0),y(null);try{let s=e||localStorage.getItem("access_token");if(!s)return void y("No access token found");let a=await (0,l.p)(k,s);console.log("Order data loaded:",a),console.log("Customer info:",a.customer_info),v(a)}catch(e){if(console.error("Failed to load order:",e),e instanceof Error&&(e.message.includes("401")||e.message.includes("Unauthorized"))){localStorage.removeItem("access_token");let e=window.location.pathname;p.push("/auth/login?redirect=".concat(encodeURIComponent(e)));return}y(e instanceof Error?e.message:"Failed to load order")}finally{N(!1)}};I&&k&&e()},[I,k]);let S=e=>"string"==typeof e?parseFloat(e):e,b=e=>S(e).toFixed(2);return I?x?(0,t.jsx)("div",{className:c().orderDetailsPage,children:(0,t.jsx)("div",{className:c().container,children:(0,t.jsxs)("div",{className:c().loadingState,children:[(0,t.jsx)("div",{className:c().spinner}),(0,t.jsx)("p",{children:_("orders.loading")})]})})}):D||!j?(0,t.jsx)("div",{className:c().orderDetailsPage,children:(0,t.jsx)("div",{className:c().container,children:(0,t.jsxs)("div",{className:c().errorState,children:[(0,t.jsx)("h2",{children:_("orders.error.title")}),(0,t.jsx)("p",{children:D||_("orders.error.orderNotFound")}),(0,t.jsx)("button",{onClick:()=>p.push("/orders"),className:c().backButton,children:_("orders.error.backToOrders")})]})})}):(0,t.jsx)("div",{className:c().orderDetailsPage,children:(0,t.jsxs)("div",{className:c().container,children:[(0,t.jsxs)("div",{className:c().header,children:[(0,t.jsxs)("button",{onClick:()=>p.push("/orders"),className:c().backButton,children:["← ",_("orders.actions.backToOrders")]}),(0,t.jsxs)("div",{className:c().headerContent,children:[(0,t.jsx)("h1",{className:c().orderNumber,children:j.order_number}),(0,t.jsxs)("div",{className:c().orderStatus,children:[(0,t.jsx)("span",{className:c().status,style:{backgroundColor:(e=>{switch(e){case"pending":return"var(--warning-color)";case"confirmed":return"var(--color-info)";case"processing":return"var(--color-primary)";case"shipped":return"var(--color-secondary)";case"delivered":return"var(--color-success)";case"cancelled":return"var(--error-color)";default:return"var(--color-text-secondary)"}})(j.status)},children:_("orders.status.".concat(j.status))}),(0,t.jsx)("span",{className:c().paymentStatus,style:{color:(e=>{switch(e){case"paid":return"var(--color-success)";case"pending":return"var(--warning-color)";case"failed":return"var(--color-error)";case"refunded":return"var(--color-info)";default:return"var(--color-text-secondary)"}})(j.payment_status)},children:_("orders.paymentStatus.".concat(j.payment_status))})]})]})]}),(0,t.jsxs)("div",{className:c().content,children:["          ",(0,t.jsxs)("div",{className:c().section,children:[(0,t.jsx)("h2",{className:c().sectionTitle,children:_("orderDetails.summary.title")}),(0,t.jsxs)("div",{className:c().summaryGrid,children:[(0,t.jsxs)("div",{className:c().summaryItem,children:[(0,t.jsxs)("span",{className:c().label,children:[_("orders.orderDate"),":"]}),(0,t.jsx)("span",{className:c().value,children:new Date(j.created_at).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),(0,t.jsxs)("div",{className:c().summaryItem,children:[(0,t.jsxs)("span",{className:c().label,children:[_("orders.total"),":"]}),(0,t.jsxs)("span",{className:c().value,children:["$",b(j.total_amount)]})]})]})]}),(0,t.jsxs)("div",{className:c().section,children:[(0,t.jsx)("h2",{className:c().sectionTitle,children:_("orderDetails.customer.title")}),(0,t.jsxs)("div",{className:c().customerInfo,children:[(0,t.jsxs)("div",{className:c().infoItem,children:[(0,t.jsxs)("span",{className:c().label,children:[_("orderDetails.customer.name"),":"]}),(0,t.jsxs)("span",{className:c().value,children:[(null==(e=j.customer_info)?void 0:e.first_name)||""," ",(null==(s=j.customer_info)?void 0:s.last_name)||"",!(null==(a=j.customer_info)?void 0:a.first_name)&&!(null==(d=j.customer_info)?void 0:d.last_name)&&(0,t.jsx)("span",{className:c().missingInfo,children:"Name not provided"})]})]}),(0,t.jsxs)("div",{className:c().infoItem,children:[(0,t.jsxs)("span",{className:c().label,children:[_("orderDetails.customer.email"),":"]}),(0,t.jsx)("span",{className:c().value,children:(null==(m=j.customer_info)?void 0:m.email)||(0,t.jsx)("span",{className:c().missingInfo,children:"Email not provided"})})]}),(0,t.jsxs)("div",{className:c().infoItem,children:[(0,t.jsxs)("span",{className:c().label,children:[_("orderDetails.customer.phone"),":"]}),(0,t.jsx)("span",{className:c().value,children:(null==(u=j.customer_info)?void 0:u.phone)||(0,t.jsx)("span",{className:c().missingInfo,children:"Phone not provided"})})]})]})]}),(0,t.jsxs)("div",{className:c().section,children:[(0,t.jsx)("h2",{className:c().sectionTitle,children:_("orderDetails.shipping.title")}),(0,t.jsxs)("div",{className:c().shippingInfo,children:[(0,t.jsxs)("div",{className:c().addressInfo,children:[(0,t.jsx)("h3",{children:_("orderDetails.shipping.address")}),(0,t.jsxs)("div",{className:c().address,children:[(0,t.jsx)("p",{children:j.shipping_address.street_address}),(0,t.jsxs)("p",{children:[j.shipping_address.city,", ",j.shipping_address.state]}),(0,t.jsx)("p",{children:j.shipping_address.postal_code})]})]}),j.tracking_number&&(0,t.jsxs)("div",{className:c().trackingInfo,children:[(0,t.jsx)("h3",{children:_("orders.delivery.trackingNumber")}),(0,t.jsxs)("div",{className:c().trackingDetails,children:[(0,t.jsx)("span",{className:c().trackingNumber,children:j.tracking_number}),(0,t.jsx)("button",{className:c().trackButton,onClick:()=>{alert("Track order: ".concat(j.tracking_number))},children:_("orders.delivery.track")})]})]}),j.estimated_delivery&&(0,t.jsxs)("div",{className:c().deliveryInfo,children:[(0,t.jsx)("h3",{children:_("orders.delivery.estimated")}),(0,t.jsx)("p",{children:new Date(j.estimated_delivery).toLocaleDateString()})]})]})]}),(0,t.jsxs)("div",{className:c().section,children:[(0,t.jsx)("h2",{className:c().sectionTitle,children:_("orderDetails.items.title")}),(0,t.jsx)("div",{className:c().itemsList,children:j.items.map(e=>(0,t.jsxs)("div",{className:c().orderItem,children:[(0,t.jsx)("div",{className:c().itemImage,children:(0,t.jsx)("img",{src:e.image,alt:e.name})}),(0,t.jsxs)("div",{className:c().itemDetails,children:[(0,t.jsx)("h4",{className:c().itemName,children:e.name}),(0,t.jsxs)("div",{className:c().itemVariants,children:[e.color&&(0,t.jsxs)("span",{className:c().variant,children:[_("orders.item.color"),": ",e.color]}),e.size&&(0,t.jsxs)("span",{className:c().variant,children:[_("orders.item.size"),": ",e.size]})]}),(0,t.jsxs)("div",{className:c().itemPricing,children:[(0,t.jsxs)("span",{className:c().quantity,children:[_("orders.item.quantity"),": ",e.quantity]}),"                      ",(0,t.jsxs)("span",{className:c().unitPrice,children:["$",b(e.price)," ",_("orderDetails.items.each")]}),(0,t.jsxs)("span",{className:c().totalPrice,children:["$",b(S(e.price)*e.quantity)]})]})]})]},e.id))})]}),(0,t.jsxs)("div",{className:c().section,children:[(0,t.jsx)("h2",{className:c().sectionTitle,children:_("orderDetails.total.title")}),"            ",(0,t.jsxs)("div",{className:c().orderTotal,children:[(0,t.jsxs)("div",{className:c().totalItem,children:[(0,t.jsxs)("span",{className:c().label,children:[_("orderDetails.total.subtotal"),":"]}),(0,t.jsxs)("span",{className:c().value,children:["$",b(S(j.total_amount)-S(j.shipping_cost)+S(j.discount_amount))]})]}),(0,t.jsxs)("div",{className:c().totalItem,children:[(0,t.jsxs)("span",{className:c().label,children:[_("orderDetails.total.shipping"),":"]}),(0,t.jsx)("span",{className:c().value,children:0===S(j.shipping_cost)?_("orderDetails.total.free"):"$".concat(b(j.shipping_cost))})]}),S(j.discount_amount)>0&&(0,t.jsxs)("div",{className:c().totalItem,children:[(0,t.jsxs)("span",{className:c().label,children:[_("orderDetails.total.discount"),":"]}),(0,t.jsxs)("span",{className:c().value,children:["-$",b(j.discount_amount)]})]}),(0,t.jsxs)("div",{className:c().totalItem+" "+c().grandTotal,children:[(0,t.jsxs)("span",{className:c().label,children:[_("orderDetails.total.total"),":"]}),(0,t.jsxs)("span",{className:c().value,children:["$",b(j.total_amount)]})]})]})]}),"          ",(0,t.jsxs)("div",{className:c().actions,children:["            ","pending"===j.payment_status&&"cancelled"!==j.status&&(0,t.jsx)("button",{className:c().retryPaymentButton,onClick:()=>{if(!j)return;let e=parseFloat(j.total_amount||"0"),s="https://payment.gateway.com/pay?amount=".concat(e.toFixed(2),"&currency=EUR&orderid=").concat(j.id,"&returnUrl=").concat(encodeURIComponent(window.location.origin+"/payment-result?status=success&orderid="+j.id),"&cancelUrl=").concat(encodeURIComponent(window.location.origin+"/payment-result?status=cancelled&orderid="+j.id));window.location.href=s},children:_("orders.actions.retryPayment")||"Retry Payment"}),"delivered"===j.status&&(0,t.jsx)("button",{className:c().reorderButton,onClick:()=>{alert("Items added to cart!")},children:_("orders.actions.reorder")}),("pending"===j.status||"confirmed"===j.status)&&(0,t.jsx)("button",{className:c().cancelButton,onClick:()=>{confirm(_("orders.actions.confirmCancel"))&&alert("Order cancelled")},children:_("orders.actions.cancel")}),(0,t.jsx)("button",{className:c().printButton,onClick:()=>window.print(),children:_("orderDetails.actions.print")})]})]})]})}):(0,t.jsx)("div",{className:c().orderDetailsPage,children:(0,t.jsx)("div",{className:c().container,children:(0,t.jsxs)("div",{className:c().loadingState,children:[(0,t.jsx)("div",{className:c().spinner}),(0,t.jsx)("p",{children:"Loading..."})]})})})}},4153:e=>{e.exports={orderDetailsPage:"orderDetails_orderDetailsPage__8xsKV",backgroundShift:"orderDetails_backgroundShift__Z68OD",container:"orderDetails_container__q_ZRG",loadingState:"orderDetails_loadingState__YcIes",errorState:"orderDetails_errorState__oVWwn",fadeInUp:"orderDetails_fadeInUp__k5dG3",spinner:"orderDetails_spinner__cXtDg",spin:"orderDetails_spin__A3bka",pulse:"orderDetails_pulse__s4fE3",header:"orderDetails_header__s5m5H",slideInFromTop:"orderDetails_slideInFromTop__KIsnm",shimmer:"orderDetails_shimmer__jINuf",backButton:"orderDetails_backButton__Y17To",headerContent:"orderDetails_headerContent__L9Gsr",fadeInRight:"orderDetails_fadeInRight__2ObWb",orderNumber:"orderDetails_orderNumber__tHPFC",expandWidth:"orderDetails_expandWidth__ww7nR",orderStatus:"orderDetails_orderStatus__atFwX",status:"orderDetails_status__kCY0s",paymentStatus:"orderDetails_paymentStatus__oSZqz",content:"orderDetails_content__2qOGm",section:"orderDetails_section__l3nqU",sectionTitle:"orderDetails_sectionTitle__SfsmT",slideInFromLeft:"orderDetails_slideInFromLeft___LQsD",summaryGrid:"orderDetails_summaryGrid__m2EFv",summaryItem:"orderDetails_summaryItem__WYEpt",label:"orderDetails_label__yFzGW",value:"orderDetails_value__6hGc_",customerInfo:"orderDetails_customerInfo__iuGWo",infoItem:"orderDetails_infoItem__Z8gmI",missingInfo:"orderDetails_missingInfo__nG1IG",shippingInfo:"orderDetails_shippingInfo___Dpbp",addressInfo:"orderDetails_addressInfo__wEhH7",trackingInfo:"orderDetails_trackingInfo__aHmbx",deliveryInfo:"orderDetails_deliveryInfo__T8RZk",address:"orderDetails_address___39I_",trackingDetails:"orderDetails_trackingDetails__lYWvT",trackingNumber:"orderDetails_trackingNumber__VCkuA",trackButton:"orderDetails_trackButton__E4SKl",itemsList:"orderDetails_itemsList__5snSz",orderItem:"orderDetails_orderItem__PX1in",itemImage:"orderDetails_itemImage__2lCm5",itemDetails:"orderDetails_itemDetails__J0jAM",itemName:"orderDetails_itemName__u8ACM",itemVariants:"orderDetails_itemVariants__0YZk3",variant:"orderDetails_variant__4s2ZY",itemPricing:"orderDetails_itemPricing__hZjEP",quantity:"orderDetails_quantity__R04Iz",unitPrice:"orderDetails_unitPrice__RRYNW",totalPrice:"orderDetails_totalPrice__7BjVS",orderTotal:"orderDetails_orderTotal__HaH6J",totalItem:"orderDetails_totalItem__a697F",grandTotal:"orderDetails_grandTotal__22uV_",actions:"orderDetails_actions__oRBNJ",reorderButton:"orderDetails_reorderButton__RrrG2",cancelButton:"orderDetails_cancelButton__EH3Gj",printButton:"orderDetails_printButton__7AUCe",retryPaymentButton:"orderDetails_retryPaymentButton__UXngL",fadeIn:"orderDetails_fadeIn__oUx5p",slideInUp:"orderDetails_slideInUp__cdNnk",glow:"orderDetails_glow__l5I2N"}},5695:(e,s,a)=>{"use strict";var t=a(8999);a.o(t,"useParams")&&a.d(s,{useParams:function(){return t.useParams}}),a.o(t,"usePathname")&&a.d(s,{usePathname:function(){return t.usePathname}}),a.o(t,"useRouter")&&a.d(s,{useRouter:function(){return t.useRouter}}),a.o(t,"useSearchParams")&&a.d(s,{useSearchParams:function(){return t.useSearchParams}})},7794:(e,s,a)=>{Promise.resolve().then(a.bind(a,2810))},9493:(e,s,a)=>{"use strict";a.d(s,{FK:()=>r,It:()=>n,N4:()=>l,fS:()=>o,mK:()=>u,p:()=>i,u:()=>d});let t="http://localhost:8000/api/v1";async function r(e,s){let a=new URL("".concat(t,"/orders/"));s&&(s.status&&"all"!==s.status&&a.searchParams.append("status",s.status),s.ordering&&a.searchParams.append("ordering",s.ordering),s.page&&a.searchParams.append("page",s.page.toString()),s.page_size&&a.searchParams.append("page_size",s.page_size.toString()));let r=await fetch(a.toString(),{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!r.ok){if(401===r.status)throw Error("Unauthorized - please log in again");throw Error("Failed to fetch orders: ".concat(r.statusText))}let o=await r.json();return{...o,results:o.results.map(m)}}async function o(e,s){console.log("=== CREATE ORDER API CALLED ==="),console.log("API URL:","".concat(t,"/orders/create/")),console.log("Order data:",e),console.log("Token available:",!!s);let a=await fetch("".concat(t,"/orders/create/"),{method:"POST",headers:{Authorization:"Bearer ".concat(s),"Content-Type":"application/json"},body:JSON.stringify(e)});if(console.log("=== CREATE ORDER RESPONSE ==="),console.log("Status:",a.status),console.log("Status text:",a.statusText),console.log("Response OK:",a.ok),!a.ok){let e=await a.json();throw console.error("=== CREATE ORDER ERROR RESPONSE ==="),console.error("Error data:",e),Error(e.message||"Failed to create order")}let r=await a.json();console.log("=== CREATE ORDER SUCCESS ==="),console.log("Backend order response:",r);let o=m(r);return console.log("Transformed order:",o),o}async function n(e,s,a){let r={"Content-Type":"application/json"};a&&(r.Authorization="Bearer ".concat(a));let o=await fetch("".concat(t,"/orders/payment-callback/"),{method:"POST",headers:r,body:JSON.stringify({uid:e,status:"paid"===s?"success":"failed"})});if(!o.ok)throw Error((await o.json()).message||"Failed to update order payment status");if((await o.json()).success&&a)return i(String(e),a);throw Error("Payment status update failed")}async function i(e,s){let a=await fetch("".concat(t,"/orders/").concat(e,"/"),{method:"GET",headers:{Authorization:"Bearer ".concat(s),"Content-Type":"application/json"}});if(!a.ok){if(401===a.status)throw Error("Unauthorized - please log in again");if(404===a.status)throw Error("Order not found");throw Error("Failed to fetch order: ".concat(a.statusText))}return m(await a.json())}async function l(e,s){let a=await fetch("".concat(t,"/orders/").concat(e,"/cancel/"),{method:"POST",headers:{Authorization:"Bearer ".concat(s),"Content-Type":"application/json"}});if(!a.ok){if(401===a.status)throw Error("Unauthorized - please log in again");if(404===a.status)throw Error("Order not found");if(400===a.status)throw Error((await a.json()).detail||"Cannot cancel this order");throw Error("Failed to cancel order: ".concat(a.statusText))}return m(await a.json())}async function d(e,s){let a=await fetch("".concat(t,"/orders/").concat(e,"/reorder/"),{method:"POST",headers:{Authorization:"Bearer ".concat(s),"Content-Type":"application/json"}});if(!a.ok){if(401===a.status)throw Error("Unauthorized - please log in again");if(404===a.status)throw Error("Order not found");if(400===a.status)throw Error((await a.json()).detail||"Cannot reorder these items");throw Error("Failed to reorder items: ".concat(a.statusText))}return a.json()}function c(e){return{id:e.id,product_id:e.product_id,variant_id:e.variant_id,product_name:e.product_name,variant_name:e.variant_name,product_image:e.product_image,product_slug:e.product_slug,price:e.price,quantity:e.quantity,color:e.color,size:e.size,subtotal:e.subtotal,sku_snapshot:e.sku_snapshot,name:e.product_name,image:e.product_image||"/placeholder-product.png",variant:e.variant_name}}function m(e){var s,a,t,r,o,n;console.log("Transforming backend order:",e);let i=e.shipping_address_details||e.shipping_address||{};return console.log("Shipping address details:",i),console.log("User fields from backend:",{user_first_name:e.user_first_name,user_last_name:e.user_last_name,user_email:e.user_email,user_phone:e.user_phone,email_for_guest:e.email_for_guest}),{id:e.order_id||e.id,order_number:e.order_number,status:({pending_payment:"pending",processing:"processing",shipped:"shipped",delivered:"delivered",cancelled:"cancelled",refunded:"cancelled",failed:"cancelled"})[e.order_status]||"pending",payment_status:({pending:"pending",paid:"paid",failed:"failed",refunded_partial:"refunded",refunded_full:"refunded"})[e.payment_status]||"pending",created_at:e.created_at,updated_at:e.updated_at,total_amount:e.total_amount,shipping_cost:e.shipping_cost,discount_amount:e.discount_amount,subtotal_amount:e.subtotal_amount,items:(null==(s=e.items)?void 0:s.map(c))||[],shipping_address:{first_name:(null==(a=i.recipient_name)?void 0:a.split(" ")[0])||i.first_name||"",last_name:(null==(t=i.recipient_name)?void 0:t.split(" ").slice(1).join(" "))||i.last_name||"",street_address:i.street_address||i.address_line_1||"",city:i.city||"",state:i.state_province||i.state||i.region||"",postal_code:i.postal_code||i.zip_code||"",country:i.country_code||i.country||"",phone:i.phone_number||i.phone||""},shipping_method:(null==(r=e.shipping_method_details)?void 0:r.name)||e.shipping_method||"Standard",shipping_method_details:e.shipping_method_details,tracking_number:e.tracking_number,estimated_delivery:e.estimated_delivery,customer_info:{first_name:e.user_first_name||(null==(o=i.recipient_name)?void 0:o.split(" ")[0])||"",last_name:e.user_last_name||(null==(n=i.recipient_name)?void 0:n.split(" ").slice(1).join(" "))||"",email:e.user_email||e.email_for_guest||"",phone:e.user_phone||i.phone_number||""}}}async function u(e,s){console.log("=== CREATE DIRECT ORDER API CALLED ==="),console.log("API URL:","".concat(t,"/orders/create-direct/")),console.log("Order data:",e),console.log("Token available:",!!s);let a={"Content-Type":"application/json"};s&&(a.Authorization="Bearer ".concat(s));let r=await fetch("".concat(t,"/orders/create-direct/"),{method:"POST",headers:a,body:JSON.stringify(e)});if(console.log("=== CREATE DIRECT ORDER RESPONSE ==="),console.log("Status:",r.status),console.log("Status text:",r.statusText),console.log("Response OK:",r.ok),!r.ok){let e=await r.json();throw console.error("=== CREATE DIRECT ORDER ERROR RESPONSE ==="),console.error("Error data:",e),Error(e.message||"Failed to create direct order")}let o=await r.json();console.log("=== CREATE DIRECT ORDER SUCCESS ==="),console.log("Backend order response:",o);let n=m(o);return console.log("Transformed direct order:",n),n}}},e=>{var s=s=>e(e.s=s);e.O(0,[3246,4540,5295,8441,1684,7358],()=>s(7794)),_N_E=e.O()}]);