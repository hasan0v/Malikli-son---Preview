(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8922],{3208:(e,t,o)=>{Promise.resolve().then(o.bind(o,9301))},8334:e=>{e.exports={checkoutPage:"checkout_checkoutPage__Oxt8U",container:"checkout_container__GDzOa",header:"checkout_header__ZlUxF",title:"checkout_title___IbnB",content:"checkout_content__zllQ3",mainContent:"checkout_mainContent__ecFbb",sidebar:"checkout_sidebar__7IEP5",navigation:"checkout_navigation__t7G5u",backButton:"checkout_backButton__ZIt2k",continueButton:"checkout_continueButton__jkgBp",spinner:"checkout_spinner__5GGpM",spin:"checkout_spin__sL5rA",errorMessage:"checkout_errorMessage__WSOsj",emptyCart:"checkout_emptyCart__aTX89"}},9301:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>R});var s=o(5155),a=o(2115),r=o(4540),i=o(5695),n=o(4089),c=o(8395),d=o(5404),l=o(9493),u=o(167),p=o(171),_=o(8334),h=o.n(_),m=o(8719),g=o(1579),y=o(4893),f=o(3825),k=o(5775),v=o(2320);function R(){let{t:e}=(0,p.useI18n)(),t=(0,i.useRouter)(),o=(0,r.wA)(),_=(0,i.useSearchParams)(),{items:R,cartId:E}=(0,r.d4)(e=>e.cart),{user:C,isAuthenticated:I}=(0,r.d4)(e=>e.auth),[N,S]=(0,a.useState)(!1),[b,A]=(0,a.useState)(null),[w,D]=(0,a.useState)(null),[x,O]=(0,a.useState)(!1),[j,U]=(0,a.useState)([]),[T,q]=(0,a.useState)(!1),[L,F]=(0,a.useState)(!1),[P,B]=(0,a.useState)(null);(0,a.useEffect)(()=>{O(!0)},[]),(0,a.useEffect)(()=>{if(x&&!I){let e="/checkout"+(window.location.search||"");localStorage.setItem("redirectAfterLogin",e),t.push("/auth/login")}},[x,I,t]),(0,a.useEffect)(()=>{if(x&&_)if("true"===_.get("buyNow")){S(!0),A({id:parseInt(_.get("productId")||"0"),name:_.get("productName")||"",slug:_.get("productSlug")||"",price:parseFloat(_.get("price")||"0"),quantity:parseInt(_.get("quantity")||"1"),variantId:_.get("variantId")?parseInt(_.get("variantId")):void 0,image:_.get("image")||"",color:_.get("color")||void 0,colorCode:_.get("colorCode")||void 0,size:_.get("size")||void 0});let e=_.get("buyNowLink");console.log("Buy Now Link from URL params:",e),D(e)}else 0===R.length&&t.push("/cart")},[x,_,R,t]);let[M,z]=(0,a.useState)(1),[G,Y]=(0,a.useState)(c.z),[H,K]=(0,a.useState)(!1),[W,Q]=(0,a.useState)({}),[V,X]=(0,a.useState)({customer_info:{first_name:"",last_name:"",email:"",phone:""},shipping_address:{street_address:"",apartment:"",city:"",state:"",postal_code:"",country:"BY"},save_address:!1,shipping_method:null,payment_method:null,customer_notes:""}),[Z,J]=(0,a.useState)([{id:1,name:e("checkout.shipping.standardShipping"),description:e("checkout.shipping.standardDescription"),cost:15,estimated_delivery_min_days:5,estimated_delivery_max_days:14,is_active:!0}]);(0,a.useEffect)(()=>{I&&C&&x&&X(e=>({...e,customer_info:{...e.customer_info,first_name:C.first_name||"",last_name:C.last_name||"",email:C.email||"",phone:C.phone_number||""}}))},[I,C,x]),(0,a.useEffect)(()=>{x&&X(e=>{let t={};return(e.shipping_method||1!==Z.length||(t.shipping_method=Z[0]),e.payment_method||1!==c.u.length||(t.payment_method=c.u[0]),Object.keys(t).length>0)?{...e,...t}:e})},[x,Z]);let $=async()=>{if(I&&C){q(!0);try{let e=localStorage.getItem("access_token");if(e){let t=await (0,d.Y9)(e),o=Array.isArray(t)?t:[];U(o)}}catch(e){console.error("Failed to load user addresses:",e),U([])}finally{q(!1)}}};(0,a.useEffect)(()=>{I&&C&&x&&$()},[I,C,x]);let ee=(()=>{var e;let t=N&&b?[b]:R,o=t.reduce((e,t)=>e+t.price*t.quantity,0),s=(null==(e=V.shipping_method)?void 0:e.cost)||0;return{subtotal:o,shipping_cost:s,tax_amount:0,discount_amount:0,total_amount:o+s-0,items:t.map((e,t)=>({id:t+1,product_id:e.id,variant_id:e.variantId,name:e.name,price:e.price,quantity:e.quantity,image:e.image,color:e.color,colorCode:e.colorCode,size:e.size,variant:e.variantId?"".concat(e.color||""," ").concat(e.size||"").trim():void 0}))}})(),et=(0,a.useCallback)(t=>{let o={};switch(t){case 1:V.customer_info.first_name||(o.first_name=e("checkout.validation.firstNameRequired")),V.customer_info.last_name||(o.last_name=e("checkout.validation.lastNameRequired")),V.customer_info.email||(o.email=e("checkout.validation.emailRequired")),V.shipping_address.street_address||(o.street_address=e("checkout.validation.addressRequired")),V.shipping_address.city||(o.city=e("checkout.validation.cityRequired")),V.shipping_address.postal_code||(o.postal_code=e("checkout.validation.postalCodeRequired"));break;case 2:V.shipping_method||(o.shipping_method=e("checkout.validation.shippingMethodRequired"));break;case 3:V.payment_method||(o.payment_method=e("checkout.validation.paymentMethodRequired"))}return 0===Object.keys(o).length},[V]),eo=(0,a.useCallback)(e=>{for(let t=1;t<e;t++)if(!et(t))return!1;return!0},[et]),es=(0,a.useCallback)(e=>{Y(t=>t.map((t,o)=>{let s=o+1,a=s<e,r=s===e,i=1===s;return s>1&&(i=eo(s)),{...t,completed:a,current:r,accessible:i}}))},[eo]);(0,a.useEffect)(()=>{x&&es(M)},[V.customer_info,V.shipping_address,V.shipping_method,V.payment_method,M,x,es]);let ea=()=>{M<4&&z(M+1)},er=()=>{M>1&&z(M-1)},ei=e=>{X(t=>({...t,...e}))},en=()=>{let t=et(M);if(!t){let t={};switch(M){case 1:V.customer_info.first_name||(t.first_name=e("checkout.validation.firstNameRequired")),V.customer_info.last_name||(t.last_name=e("checkout.validation.lastNameRequired")),V.customer_info.email||(t.email=e("checkout.validation.emailRequired")),V.shipping_address.street_address||(t.street_address=e("checkout.validation.addressRequired")),V.shipping_address.city||(t.city=e("checkout.validation.cityRequired")),V.shipping_address.postal_code||(t.postal_code=e("checkout.validation.postalCodeRequired"));break;case 2:V.shipping_method||(t.shipping_method=e("checkout.validation.shippingMethodRequired"));break;case 3:V.payment_method||(t.payment_method=e("checkout.validation.paymentMethodRequired"))}Q(t)}return t},ec=async()=>{if(I&&C&&!L&&V.shipping_address.street_address&&V.shipping_address.city&&V.shipping_address.postal_code&&V.customer_info.first_name&&V.customer_info.last_name){F(!0);try{let e=localStorage.getItem("access_token");if(e){let t=Array.isArray(j)?j:[];if(!t.find(e=>e.street_address===V.shipping_address.street_address&&e.city===V.shipping_address.city&&e.postal_code===V.shipping_address.postal_code)){let o={address_type:"shipping",recipient_name:"".concat(V.customer_info.first_name," ").concat(V.customer_info.last_name).trim(),street_address:V.shipping_address.street_address,address_line_2:V.shipping_address.apartment||void 0,city:V.shipping_address.city,state_province:V.shipping_address.state||"",postal_code:V.shipping_address.postal_code,country_code:V.shipping_address.country,phone_number:V.customer_info.phone||void 0,is_default_shipping:0===t.length,is_default_billing:0===t.length},s=await (0,d.Ex)(o,e);U(e=>[...Array.isArray(e)?e:[],s])}}}catch(e){console.error("Failed to auto-save address:",e)}finally{F(!1)}}},ed=async t=>{if(confirm(e("checkout.confirmations.deleteAddress")))try{let e=localStorage.getItem("access_token");e&&(await (0,d.ab)(t,e),U(e=>e.filter(e=>e.id!==t)),P===t&&B(null))}catch(e){console.error("Failed to delete address:",e)}},el=async()=>{K(!0),console.log("=== ORDER SUBMISSION STARTED ==="),console.log("Current step:",M),console.log("Cart ID:",E),console.log("Selected Address ID:",P),console.log("Is authenticated:",I),console.log("User:",C),console.log("Checkout data:",V),console.log("Is buy now flow:",N);try{var t,s;let e=P,a=null;if(I&&!P){console.log("Creating address for order (save_address=",V.save_address,")");try{let t=localStorage.getItem("access_token");if(t){let o={address_type:"shipping",recipient_name:"".concat(V.customer_info.first_name," ").concat(V.customer_info.last_name).trim(),street_address:V.shipping_address.street_address,address_line_2:V.shipping_address.apartment||void 0,city:V.shipping_address.city,state_province:V.shipping_address.state||"",postal_code:V.shipping_address.postal_code,country_code:V.shipping_address.country,phone_number:V.customer_info.phone||void 0,is_default_shipping:V.save_address,is_default_billing:V.save_address};console.log("Address data to save:",o);let s=await (0,d.Ex)(o,t);e=s.id,console.log("Address saved successfully:",s)}else throw Error("Authentication token not found")}catch(e){throw console.error("Failed to save address:",e),Error("Failed to save shipping address: "+(e instanceof Error?e.message:"Unknown error"))}}else P&&(console.log("Using existing selected address:",P),e=P);if(N&&b){if(console.log("=== BUY NOW FLOW - CREATING DIRECT ORDER ==="),console.log("Buy now product:",b),!e)throw console.log("=== ERROR: NO ADDRESS ID ==="),Error("Shipping address is required. Please ensure address is saved or selected.");let o=localStorage.getItem("access_token");if(!o)throw console.log("=== ERROR: NO AUTH TOKEN ==="),Error("Authentication required");let s={product_id:b.id,quantity:b.quantity||1,shipping_address_id:e,billing_address_id:e,shipping_method_id:(null==(t=V.shipping_method)?void 0:t.id)||1,customer_notes:V.customer_notes||""};b.variantId&&(s.product_variant_id=b.variantId),b.color&&(s.color=b.color),b.colorCode&&(s.color_code=b.colorCode),b.size&&(s.size=b.size),console.log("=== SENDING DIRECT ORDER CREATION REQUEST ==="),console.log("Direct order data:",s),a=await (0,l.mK)(s,o),console.log("=== DIRECT ORDER CREATED SUCCESSFULLY ==="),console.log("Created order:",a)}else{console.log("=== REGULAR CHECKOUT FLOW - PROCEEDING WITH ORDER CREATION ===");let t=E;if(!t){console.log("=== NO CART ID - CREATING TEMPORARY CART FOR SINGLE ITEM ===");let e=N&&b?[b]:R;if(0===e.length)throw Error("No items to order. Please add items to cart first.");console.log("Items to add to cart:",e);let o=await (0,u.zA)();if(!o)throw Error("Failed to create cart for order");for(let s of(t=o.cart_id,console.log("✓ Temporary cart created:",t),e)){let e={drop_product:s.dropProductId,product_variant:s.variantId,quantity:s.quantity,color:s.color,color_code:s.colorCode,size:s.size};if(console.log("Adding item to cart:",e),!await (0,u.r5)(t,e))throw Error("Failed to add ".concat(s.name," to cart"))}console.log("✓ All items added to temporary cart")}if(!t)throw console.log("=== ERROR: NO CART ID AVAILABLE ==="),Error("Cart ID not available. Please refresh and try again.");if(console.log("✓ Cart ID available:",t),!e)throw console.log("=== ERROR: NO ADDRESS ID ==="),Error("Shipping address is required. Please ensure address is saved or selected.");console.log("✓ Address ID available:",e);let r=localStorage.getItem("access_token");if(!r)throw console.log("=== ERROR: NO AUTH TOKEN ==="),Error("Authentication required");console.log("✓ Auth token available"),console.log("=== CREATING ORDER ===");let i={cart_id:t,shipping_address_id:e,billing_address_id:e,shipping_method_id:(null==(s=V.shipping_method)?void 0:s.id)||1,customer_notes:V.customer_notes||""};console.log("=== SENDING ORDER CREATION REQUEST ==="),console.log("Order data:",i),a=await (0,l.fS)(i,r),console.log("=== ORDER CREATED SUCCESSFULLY ==="),console.log("Created order:",a),o((0,n.sX)())}console.log("=== REDIRECTING TO PAYMENT ==="),console.log("isBuyNowFlow:",N),console.log("buyNowProduct:",b),console.log("buyNowLink:",w),console.log("buyNowLink type:",typeof w),console.log("buyNowLink length:",w?w.length:"null/undefined");let r="";N&&b?w?(console.log("Using product buy now link from URL params:",w),r=w):(console.log("No buy_now_link found, using generic payment gateway"),r="https://payment.gateway.com/pay?amount=".concat(ee.total_amount.toFixed(2),"&currency=EUR&orderid=").concat(a.id,"&returnUrl=").concat(encodeURIComponent(window.location.origin+"/payment-result?status=success&orderid="+a.id),"&cancelUrl=").concat(encodeURIComponent(window.location.origin+"/payment-result?status=cancelled&orderid="+a.id))):(console.log("Regular checkout flow, using generic payment gateway"),r="https://payment.gateway.com/pay?amount=".concat(ee.total_amount.toFixed(2),"&currency=EUR&orderid=").concat(a.id,"&returnUrl=").concat(encodeURIComponent(window.location.origin+"/payment-result?status=success&orderid="+a.id),"&cancelUrl=").concat(encodeURIComponent(window.location.origin+"/payment-result?status=cancelled&orderid="+a.id))),console.log("Final payment URL:",r),window.location.href=r}catch(t){console.error("=== ORDER SUBMISSION FAILED ==="),console.error("Error:",t),console.error("Error message:",t instanceof Error?t.message:"Unknown error"),console.error("Error stack:",t instanceof Error?t.stack:"No stack trace"),Q({submit:e("checkout.error.orderSubmissionFailed")+": "+(t instanceof Error?t.message:"Unknown error")})}finally{K(!1)}};return x?N||0!==R.length?N&&!b?(0,s.jsxs)("div",{className:h().emptyCart,children:[(0,s.jsx)("h2",{children:e("checkout.error.title")}),(0,s.jsx)("p",{children:e("checkout.error.productLoadFailed")})]}):(0,s.jsx)("div",{className:h().checkoutPage,children:(0,s.jsxs)("div",{className:h().container,children:[(0,s.jsxs)("div",{className:h().header,children:[(0,s.jsx)("h1",{className:h().title,children:e("checkout.title")}),(0,s.jsx)(v.A,{steps:G,currentStep:M,onStepClick:e=>{let t=G.find(t=>t.id===e);(e<=M||t&&t.accessible)&&z(e)}})]}),(0,s.jsxs)("div",{className:h().content,children:[(0,s.jsxs)("div",{className:h().mainContent,children:["            ",1===M&&(0,s.jsx)(m.A,{checkoutData:V,updateCheckoutData:ei,errors:W,isAuthenticated:I,userAddresses:j,isLoadingAddresses:T,autoSaveInProgress:L,onLoadSavedAddress:e=>{B(e.id),X(t=>({...t,shipping_address:{street_address:e.street_address,apartment:e.address_line_2||"",city:e.city,state:e.state_province,postal_code:e.postal_code,country:e.country_code}}))},onDeleteAddress:ed,selectedAddressId:P}),2===M&&(0,s.jsx)(g.A,{checkoutData:V,updateCheckoutData:ei,shippingMethods:Z,errors:W}),3===M&&(0,s.jsx)(y.A,{checkoutData:V,updateCheckoutData:ei,paymentMethods:c.u,errors:W,orderSummary:ee}),"            ",4===M&&(0,s.jsx)(f.A,{checkoutData:V,orderSummary:ee,onPlaceOrder:el,isLoading:H}),"            ",M<4&&(0,s.jsxs)("div",{className:h().navigation,children:[M>1&&(0,s.jsx)("button",{type:"button",onClick:er,className:h().backButton,disabled:H,children:e("checkout.navigation.back")}),(0,s.jsx)("button",{type:"button",onClick:()=>{console.log("=== HANDLE CONTINUE CLICKED ==="),console.log("Current step:",M),console.log("Validation result:",en()),en()?1===M?(console.log("Step 1: Auto-saving address and moving to next step"),ec().then(()=>{ea()})):4===M?(console.log("Step 4: Starting order submission"),el()):(console.log("Step ".concat(M,": Moving to next step")),ea()):console.log("Validation failed, errors:",W)},className:h().continueButton,disabled:H,children:H?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:h().spinner}),e("checkout.navigation.processing")]}):e("checkout.navigation.continue")})]}),4===M&&(0,s.jsx)("div",{className:h().navigation,children:(0,s.jsx)("button",{type:"button",onClick:er,className:h().backButton,disabled:H,children:e("checkout.navigation.back")})}),W.submit&&(0,s.jsx)("div",{className:h().errorMessage,children:W.submit})]}),"          ",(0,s.jsx)("div",{className:h().sidebar,children:(0,s.jsx)(k.A,{orderSummary:ee,isLoading:H})})]})]})}):(0,s.jsxs)("div",{className:h().emptyCart,children:[(0,s.jsx)("h2",{children:e("checkout.emptyCart.title")}),(0,s.jsx)("p",{children:e("checkout.emptyCart.message")})]}):(0,s.jsx)("div",{className:h().checkoutPage,children:(0,s.jsx)("div",{className:h().container,children:(0,s.jsx)("div",{className:h().header,children:(0,s.jsx)("h1",{className:h().title,children:e("checkout.loading")})})})})}}}]);