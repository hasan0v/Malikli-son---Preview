(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7403],{2076:(e,t,a)=>{Promise.resolve().then(a.bind(a,9185))},4410:e=>{e.exports={paymentResultPage:"payment-result_paymentResultPage__2FlQM",container:"payment-result_container__Rebum",loading:"payment-result_loading__tkpMF",spinner:"payment-result_spinner__nZEQr",spin:"payment-result_spin__QkbRC",success:"payment-result_success___R2pT",cancelled:"payment-result_cancelled__9PxvP",failed:"payment-result_failed__vl224",error:"payment-result_error__dql_v",icon:"payment-result_icon__O29T8",orderInfo:"payment-result_orderInfo__5ARwp",actions:"payment-result_actions__DAXyE",primaryButton:"payment-result_primaryButton__dRyf1",secondaryButton:"payment-result_secondaryButton__IjkHq"}},5695:(e,t,a)=>{"use strict";var s=a(8999);a.o(s,"useParams")&&a.d(t,{useParams:function(){return s.useParams}}),a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})},9185:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>u});var s=a(5155),r=a(2115),n=a(5695),o=a(4540),i=a(9493),c=a(5295),l=a(4410),d=a.n(l);function u(){let{t:e}=(0,c.useI18n)(),t=(0,n.useRouter)(),a=(0,n.useSearchParams)(),{isAuthenticated:l}=(0,o.d4)(e=>e.auth),[u,p]=(0,r.useState)(!0),[m,h]=(0,r.useState)(null),[_,g]=(0,r.useState)(null),[f,y]=(0,r.useState)(null);if((0,r.useEffect)(()=>{let e=async()=>{try{let e=null==a?void 0:a.get("status"),t=null==a?void 0:a.get("orderid"),s=(null==a?void 0:a.get("payment"))==="success",r=(null==a?void 0:a.get("payment"))==="cancelled",n="failed";if(s||"success"===e?n="success":r||"cancelled"===e?n="cancelled":"failed"===e&&(n="failed"),h(n),y(t||null),t&&l){let e=localStorage.getItem("access_token");if(e)try{await (0,i.It)(t,"success"===n?"paid":"cancelled"===n?"pending":"failed",e)}catch(e){console.error("Failed to update order status:",e)}}}catch(e){console.error("Error processing payment result:",e),g("Failed to process payment result")}finally{p(!1)}};a&&e()},[a,l]),u)return(0,s.jsx)("div",{className:d().paymentResultPage,children:(0,s.jsx)("div",{className:d().container,children:(0,s.jsxs)("div",{className:d().loading,children:[(0,s.jsx)("div",{className:d().spinner}),(0,s.jsx)("h2",{children:"Processing payment result..."}),(0,s.jsx)("p",{children:"Please wait while we confirm your payment status."})]})})});let E=()=>{t.push("/")},j=()=>{t.push("/orders")};return(0,s.jsx)("div",{className:d().paymentResultPage,children:(0,s.jsxs)("div",{className:d().container,children:["success"===m&&(0,s.jsxs)("div",{className:d().success,children:[(0,s.jsx)("div",{className:d().icon,children:"✅"}),(0,s.jsx)("h1",{children:"Payment Successful!"}),(0,s.jsx)("p",{children:"Your order has been successfully processed."}),f&&(0,s.jsxs)("p",{className:d().orderInfo,children:["Order ID: ",(0,s.jsx)("strong",{children:f})]}),(0,s.jsxs)("div",{className:d().actions,children:[(0,s.jsx)("button",{onClick:j,className:d().primaryButton,children:"View Orders"}),(0,s.jsx)("button",{onClick:E,className:d().secondaryButton,children:"Continue Shopping"})]})]}),"cancelled"===m&&(0,s.jsxs)("div",{className:d().cancelled,children:[(0,s.jsx)("div",{className:d().icon,children:"⚠️"}),(0,s.jsx)("h1",{children:"Payment Cancelled"}),(0,s.jsx)("p",{children:"Your payment was cancelled. Your order is still pending."}),f&&(0,s.jsxs)("p",{className:d().orderInfo,children:["Order ID: ",(0,s.jsx)("strong",{children:f})]}),(0,s.jsx)("p",{children:"You can try to complete the payment again from your orders page."}),(0,s.jsxs)("div",{className:d().actions,children:[(0,s.jsx)("button",{onClick:j,className:d().primaryButton,children:"View Orders"}),(0,s.jsx)("button",{onClick:E,className:d().secondaryButton,children:"Continue Shopping"})]})]}),"failed"===m&&(0,s.jsxs)("div",{className:d().failed,children:[(0,s.jsx)("div",{className:d().icon,children:"❌"}),(0,s.jsx)("h1",{children:"Payment Failed"}),(0,s.jsx)("p",{children:"Unfortunately, your payment could not be processed."}),f&&(0,s.jsxs)("p",{className:d().orderInfo,children:["Order ID: ",(0,s.jsx)("strong",{children:f})]}),(0,s.jsx)("p",{children:"Please try again or contact support if the problem persists."}),(0,s.jsxs)("div",{className:d().actions,children:[(0,s.jsx)("button",{onClick:j,className:d().primaryButton,children:"View Orders"}),(0,s.jsx)("button",{onClick:E,className:d().secondaryButton,children:"Continue Shopping"})]})]}),_&&(0,s.jsxs)("div",{className:d().error,children:[(0,s.jsx)("div",{className:d().icon,children:"⚠️"}),(0,s.jsx)("h1",{children:"Error"}),(0,s.jsx)("p",{children:_}),(0,s.jsx)("div",{className:d().actions,children:(0,s.jsx)("button",{onClick:E,className:d().primaryButton,children:"Go Home"})})]})]})})}},9493:(e,t,a)=>{"use strict";a.d(t,{FK:()=>r,It:()=>o,N4:()=>c,fS:()=>n,mK:()=>p,p:()=>i,u:()=>l});let s="http://localhost:8000/api/v1";async function r(e,t){let a=new URL("".concat(s,"/orders/"));t&&(t.status&&"all"!==t.status&&a.searchParams.append("status",t.status),t.ordering&&a.searchParams.append("ordering",t.ordering),t.page&&a.searchParams.append("page",t.page.toString()),t.page_size&&a.searchParams.append("page_size",t.page_size.toString()));let r=await fetch(a.toString(),{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!r.ok){if(401===r.status)throw Error("Unauthorized - please log in again");throw Error("Failed to fetch orders: ".concat(r.statusText))}let n=await r.json();return{...n,results:n.results.map(u)}}async function n(e,t){console.log("=== CREATE ORDER API CALLED ==="),console.log("API URL:","".concat(s,"/orders/create/")),console.log("Order data:",e),console.log("Token available:",!!t);let a=await fetch("".concat(s,"/orders/create/"),{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify(e)});if(console.log("=== CREATE ORDER RESPONSE ==="),console.log("Status:",a.status),console.log("Status text:",a.statusText),console.log("Response OK:",a.ok),!a.ok){let e=await a.json();throw console.error("=== CREATE ORDER ERROR RESPONSE ==="),console.error("Error data:",e),Error(e.message||"Failed to create order")}let r=await a.json();console.log("=== CREATE ORDER SUCCESS ==="),console.log("Backend order response:",r);let n=u(r);return console.log("Transformed order:",n),n}async function o(e,t,a){let r={"Content-Type":"application/json"};a&&(r.Authorization="Bearer ".concat(a));let n=await fetch("".concat(s,"/orders/payment-callback/"),{method:"POST",headers:r,body:JSON.stringify({uid:e,status:"paid"===t?"success":"failed"})});if(!n.ok)throw Error((await n.json()).message||"Failed to update order payment status");if((await n.json()).success&&a)return i(String(e),a);throw Error("Payment status update failed")}async function i(e,t){let a=await fetch("".concat(s,"/orders/").concat(e,"/"),{method:"GET",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}});if(!a.ok){if(401===a.status)throw Error("Unauthorized - please log in again");if(404===a.status)throw Error("Order not found");throw Error("Failed to fetch order: ".concat(a.statusText))}return u(await a.json())}async function c(e,t){let a=await fetch("".concat(s,"/orders/").concat(e,"/cancel/"),{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}});if(!a.ok){if(401===a.status)throw Error("Unauthorized - please log in again");if(404===a.status)throw Error("Order not found");if(400===a.status)throw Error((await a.json()).detail||"Cannot cancel this order");throw Error("Failed to cancel order: ".concat(a.statusText))}return u(await a.json())}async function l(e,t){let a=await fetch("".concat(s,"/orders/").concat(e,"/reorder/"),{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}});if(!a.ok){if(401===a.status)throw Error("Unauthorized - please log in again");if(404===a.status)throw Error("Order not found");if(400===a.status)throw Error((await a.json()).detail||"Cannot reorder these items");throw Error("Failed to reorder items: ".concat(a.statusText))}return a.json()}function d(e){return{id:e.id,product_id:e.product_id,variant_id:e.variant_id,product_name:e.product_name,variant_name:e.variant_name,product_image:e.product_image,product_slug:e.product_slug,price:e.price,quantity:e.quantity,color:e.color,size:e.size,subtotal:e.subtotal,sku_snapshot:e.sku_snapshot,name:e.product_name,image:e.product_image||"/placeholder-product.png",variant:e.variant_name}}function u(e){var t,a,s,r,n,o;console.log("Transforming backend order:",e);let i=e.shipping_address_details||e.shipping_address||{};return console.log("Shipping address details:",i),console.log("User fields from backend:",{user_first_name:e.user_first_name,user_last_name:e.user_last_name,user_email:e.user_email,user_phone:e.user_phone,email_for_guest:e.email_for_guest}),{id:e.order_id||e.id,order_number:e.order_number,status:({pending_payment:"pending",processing:"processing",shipped:"shipped",delivered:"delivered",cancelled:"cancelled",refunded:"cancelled",failed:"cancelled"})[e.order_status]||"pending",payment_status:({pending:"pending",paid:"paid",failed:"failed",refunded_partial:"refunded",refunded_full:"refunded"})[e.payment_status]||"pending",created_at:e.created_at,updated_at:e.updated_at,total_amount:e.total_amount,shipping_cost:e.shipping_cost,discount_amount:e.discount_amount,subtotal_amount:e.subtotal_amount,items:(null==(t=e.items)?void 0:t.map(d))||[],shipping_address:{first_name:(null==(a=i.recipient_name)?void 0:a.split(" ")[0])||i.first_name||"",last_name:(null==(s=i.recipient_name)?void 0:s.split(" ").slice(1).join(" "))||i.last_name||"",street_address:i.street_address||i.address_line_1||"",city:i.city||"",state:i.state_province||i.state||i.region||"",postal_code:i.postal_code||i.zip_code||"",country:i.country_code||i.country||"",phone:i.phone_number||i.phone||""},shipping_method:(null==(r=e.shipping_method_details)?void 0:r.name)||e.shipping_method||"Standard",shipping_method_details:e.shipping_method_details,tracking_number:e.tracking_number,estimated_delivery:e.estimated_delivery,customer_info:{first_name:e.user_first_name||(null==(n=i.recipient_name)?void 0:n.split(" ")[0])||"",last_name:e.user_last_name||(null==(o=i.recipient_name)?void 0:o.split(" ").slice(1).join(" "))||"",email:e.user_email||e.email_for_guest||"",phone:e.user_phone||i.phone_number||""}}}async function p(e,t){console.log("=== CREATE DIRECT ORDER API CALLED ==="),console.log("API URL:","".concat(s,"/orders/create-direct/")),console.log("Order data:",e),console.log("Token available:",!!t);let a={"Content-Type":"application/json"};t&&(a.Authorization="Bearer ".concat(t));let r=await fetch("".concat(s,"/orders/create-direct/"),{method:"POST",headers:a,body:JSON.stringify(e)});if(console.log("=== CREATE DIRECT ORDER RESPONSE ==="),console.log("Status:",r.status),console.log("Status text:",r.statusText),console.log("Response OK:",r.ok),!r.ok){let e=await r.json();throw console.error("=== CREATE DIRECT ORDER ERROR RESPONSE ==="),console.error("Error data:",e),Error(e.message||"Failed to create direct order")}let n=await r.json();console.log("=== CREATE DIRECT ORDER SUCCESS ==="),console.log("Backend order response:",n);let o=u(n);return console.log("Transformed direct order:",o),o}}},e=>{var t=t=>e(e.s=t);e.O(0,[7541,4540,5295,8441,1684,7358],()=>t(2076)),_N_E=e.O()}]);