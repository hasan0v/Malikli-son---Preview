exports.id=8922,exports.ids=[8922],exports.modules={5088:(e,t,o)=>{Promise.resolve().then(o.bind(o,54787))},30277:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>R});var s=o(60687),a=o(43210),r=o(54864),i=o(16189),n=o(26335),d=o(33859),c=o(72718),l=o(72725),u=o(15191),p=o(45067),h=o(42379),_=o.n(h),m=o(3831),g=o(75773),k=o(96029),y=o(88220),f=o(42721),v=o(79640);function R(){let{t:e}=(0,p.useI18n)();(0,i.useRouter)();let t=(0,r.wA)();(0,i.useSearchParams)();let{items:o,cartId:h}=(0,r.d4)(e=>e.cart),{user:R,isAuthenticated:E}=(0,r.d4)(e=>e.auth),[b,C]=(0,a.useState)(!1),[w,A]=(0,a.useState)(null),[N,S]=(0,a.useState)(null),[I,x]=(0,a.useState)(!1),[D,O]=(0,a.useState)([]),[P,U]=(0,a.useState)(!1),[j,T]=(0,a.useState)(!1),[q,L]=(0,a.useState)(null),[M,F]=(0,a.useState)(1),[G,B]=(0,a.useState)(d.z),[$,z]=(0,a.useState)(!1),[K,Y]=(0,a.useState)({}),[H,W]=(0,a.useState)({customer_info:{first_name:"",last_name:"",email:"",phone:""},shipping_address:{street_address:"",apartment:"",city:"",state:"",postal_code:"",country:"BY"},save_address:!1,shipping_method:null,payment_method:null,customer_notes:""}),[Q,V]=(0,a.useState)([{id:1,name:e("checkout.shipping.standardShipping"),description:e("checkout.shipping.standardDescription"),cost:15,estimated_delivery_min_days:5,estimated_delivery_max_days:14,is_active:!0}]),X=(()=>{let e=b&&w?[w]:o,t=e.reduce((e,t)=>e+t.price*t.quantity,0),s=H.shipping_method?.cost||0;return{subtotal:t,shipping_cost:s,tax_amount:0,discount_amount:0,total_amount:t+s-0,items:e.map((e,t)=>({id:t+1,product_id:e.id,variant_id:e.variantId,name:e.name,price:e.price,quantity:e.quantity,image:e.image,color:e.color,colorCode:e.colorCode,size:e.size,variant:e.variantId?`${e.color||""} ${e.size||""}`.trim():void 0}))}})(),Z=(0,a.useCallback)(t=>{let o={};switch(t){case 1:H.customer_info.first_name||(o.first_name=e("checkout.validation.firstNameRequired")),H.customer_info.last_name||(o.last_name=e("checkout.validation.lastNameRequired")),H.customer_info.email||(o.email=e("checkout.validation.emailRequired")),H.shipping_address.street_address||(o.street_address=e("checkout.validation.addressRequired")),H.shipping_address.city||(o.city=e("checkout.validation.cityRequired")),H.shipping_address.postal_code||(o.postal_code=e("checkout.validation.postalCodeRequired"));break;case 2:H.shipping_method||(o.shipping_method=e("checkout.validation.shippingMethodRequired"));break;case 3:H.payment_method||(o.payment_method=e("checkout.validation.paymentMethodRequired"))}return 0===Object.keys(o).length},[H]),J=(0,a.useCallback)(e=>{for(let t=1;t<e;t++)if(!Z(t))return!1;return!0},[Z]);(0,a.useCallback)(e=>{B(t=>t.map((t,o)=>{let s=o+1,a=s<e,r=s===e,i=1===s;return s>1&&(i=J(s)),{...t,completed:a,current:r,accessible:i}}))},[J]);let ee=()=>{M<4&&F(M+1)},et=()=>{M>1&&F(M-1)},eo=e=>{W(t=>({...t,...e}))},es=()=>{let t=Z(M);if(!t){let t={};switch(M){case 1:H.customer_info.first_name||(t.first_name=e("checkout.validation.firstNameRequired")),H.customer_info.last_name||(t.last_name=e("checkout.validation.lastNameRequired")),H.customer_info.email||(t.email=e("checkout.validation.emailRequired")),H.shipping_address.street_address||(t.street_address=e("checkout.validation.addressRequired")),H.shipping_address.city||(t.city=e("checkout.validation.cityRequired")),H.shipping_address.postal_code||(t.postal_code=e("checkout.validation.postalCodeRequired"));break;case 2:H.shipping_method||(t.shipping_method=e("checkout.validation.shippingMethodRequired"));break;case 3:H.payment_method||(t.payment_method=e("checkout.validation.paymentMethodRequired"))}Y(t)}return t},ea=async()=>{if(E&&R&&!j&&H.shipping_address.street_address&&H.shipping_address.city&&H.shipping_address.postal_code&&H.customer_info.first_name&&H.customer_info.last_name){T(!0);try{let e=localStorage.getItem("access_token");if(e){let t=Array.isArray(D)?D:[];if(!t.find(e=>e.street_address===H.shipping_address.street_address&&e.city===H.shipping_address.city&&e.postal_code===H.shipping_address.postal_code)){let o={address_type:"shipping",recipient_name:`${H.customer_info.first_name} ${H.customer_info.last_name}`.trim(),street_address:H.shipping_address.street_address,address_line_2:H.shipping_address.apartment||void 0,city:H.shipping_address.city,state_province:H.shipping_address.state||"",postal_code:H.shipping_address.postal_code,country_code:H.shipping_address.country,phone_number:H.customer_info.phone||void 0,is_default_shipping:0===t.length,is_default_billing:0===t.length},s=await (0,c.Ex)(o,e);O(e=>[...Array.isArray(e)?e:[],s])}}}catch(e){console.error("Failed to auto-save address:",e)}finally{T(!1)}}},er=async t=>{if(confirm(e("checkout.confirmations.deleteAddress")))try{let e=localStorage.getItem("access_token");e&&(await (0,c.ab)(t,e),O(e=>e.filter(e=>e.id!==t)),q===t&&L(null))}catch(e){console.error("Failed to delete address:",e)}},ei=async()=>{z(!0),console.log("=== ORDER SUBMISSION STARTED ==="),console.log("Current step:",M),console.log("Cart ID:",h),console.log("Selected Address ID:",q),console.log("Is authenticated:",E),console.log("User:",R),console.log("Checkout data:",H),console.log("Is buy now flow:",b);try{let e=q,s=null;if(E&&!q){console.log("Creating address for order (save_address=",H.save_address,")");try{let t=localStorage.getItem("access_token");if(t){let o={address_type:"shipping",recipient_name:`${H.customer_info.first_name} ${H.customer_info.last_name}`.trim(),street_address:H.shipping_address.street_address,address_line_2:H.shipping_address.apartment||void 0,city:H.shipping_address.city,state_province:H.shipping_address.state||"",postal_code:H.shipping_address.postal_code,country_code:H.shipping_address.country,phone_number:H.customer_info.phone||void 0,is_default_shipping:H.save_address,is_default_billing:H.save_address};console.log("Address data to save:",o);let s=await (0,c.Ex)(o,t);e=s.id,console.log("Address saved successfully:",s)}else throw Error("Authentication token not found")}catch(e){throw console.error("Failed to save address:",e),Error("Failed to save shipping address: "+(e instanceof Error?e.message:"Unknown error"))}}else q&&(console.log("Using existing selected address:",q),e=q);if(b&&w){if(console.log("=== BUY NOW FLOW - CREATING DIRECT ORDER ==="),console.log("Buy now product:",w),!e)throw console.log("=== ERROR: NO ADDRESS ID ==="),Error("Shipping address is required. Please ensure address is saved or selected.");let t=localStorage.getItem("access_token");if(!t)throw console.log("=== ERROR: NO AUTH TOKEN ==="),Error("Authentication required");let o={product_id:w.id,quantity:w.quantity||1,shipping_address_id:e,billing_address_id:e,shipping_method_id:H.shipping_method?.id||1,customer_notes:H.customer_notes||""};w.variantId&&(o.product_variant_id=w.variantId),w.color&&(o.color=w.color),w.colorCode&&(o.color_code=w.colorCode),w.size&&(o.size=w.size),console.log("=== SENDING DIRECT ORDER CREATION REQUEST ==="),console.log("Direct order data:",o),s=await (0,l.mK)(o,t),console.log("=== DIRECT ORDER CREATED SUCCESSFULLY ==="),console.log("Created order:",s)}else{console.log("=== REGULAR CHECKOUT FLOW - PROCEEDING WITH ORDER CREATION ===");let a=h;if(!a){console.log("=== NO CART ID - CREATING TEMPORARY CART FOR SINGLE ITEM ===");let e=b&&w?[w]:o;if(0===e.length)throw Error("No items to order. Please add items to cart first.");console.log("Items to add to cart:",e);let t=await (0,u.zA)();if(!t)throw Error("Failed to create cart for order");for(let o of(a=t.cart_id,console.log("✓ Temporary cart created:",a),e)){let e={drop_product:o.dropProductId,product_variant:o.variantId,quantity:o.quantity,color:o.color,color_code:o.colorCode,size:o.size};if(console.log("Adding item to cart:",e),!await (0,u.r5)(a,e))throw Error(`Failed to add ${o.name} to cart`)}console.log("✓ All items added to temporary cart")}if(!a)throw console.log("=== ERROR: NO CART ID AVAILABLE ==="),Error("Cart ID not available. Please refresh and try again.");if(console.log("✓ Cart ID available:",a),!e)throw console.log("=== ERROR: NO ADDRESS ID ==="),Error("Shipping address is required. Please ensure address is saved or selected.");console.log("✓ Address ID available:",e);let r=localStorage.getItem("access_token");if(!r)throw console.log("=== ERROR: NO AUTH TOKEN ==="),Error("Authentication required");console.log("✓ Auth token available"),console.log("=== CREATING ORDER ===");let i={cart_id:a,shipping_address_id:e,billing_address_id:e,shipping_method_id:H.shipping_method?.id||1,customer_notes:H.customer_notes||""};console.log("=== SENDING ORDER CREATION REQUEST ==="),console.log("Order data:",i),s=await (0,l.fS)(i,r),console.log("=== ORDER CREATED SUCCESSFULLY ==="),console.log("Created order:",s),t((0,n.sX)())}console.log("=== REDIRECTING TO PAYMENT ==="),console.log("isBuyNowFlow:",b),console.log("buyNowProduct:",w),console.log("buyNowLink:",N),console.log("buyNowLink type:",typeof N),console.log("buyNowLink length:",N?N.length:"null/undefined");let a="";b&&w?N?(console.log("Using product buy now link from URL params:",N),a=N):(console.log("No buy_now_link found, using generic payment gateway"),a=`https://payment.gateway.com/pay?amount=${X.total_amount.toFixed(2)}&currency=EUR&orderid=${s.id}&returnUrl=${encodeURIComponent(window.location.origin+"/payment-result?status=success&orderid="+s.id)}&cancelUrl=${encodeURIComponent(window.location.origin+"/payment-result?status=cancelled&orderid="+s.id)}`):(console.log("Regular checkout flow, using generic payment gateway"),a=`https://payment.gateway.com/pay?amount=${X.total_amount.toFixed(2)}&currency=EUR&orderid=${s.id}&returnUrl=${encodeURIComponent(window.location.origin+"/payment-result?status=success&orderid="+s.id)}&cancelUrl=${encodeURIComponent(window.location.origin+"/payment-result?status=cancelled&orderid="+s.id)}`),console.log("Final payment URL:",a),window.location.href=a}catch(t){console.error("=== ORDER SUBMISSION FAILED ==="),console.error("Error:",t),console.error("Error message:",t instanceof Error?t.message:"Unknown error"),console.error("Error stack:",t instanceof Error?t.stack:"No stack trace"),Y({submit:e("checkout.error.orderSubmissionFailed")+": "+(t instanceof Error?t.message:"Unknown error")})}finally{z(!1)}};return I?b||0!==o.length?b&&!w?(0,s.jsxs)("div",{className:_().emptyCart,children:[(0,s.jsx)("h2",{children:e("checkout.error.title")}),(0,s.jsx)("p",{children:e("checkout.error.productLoadFailed")})]}):(0,s.jsx)("div",{className:_().checkoutPage,children:(0,s.jsxs)("div",{className:_().container,children:[(0,s.jsxs)("div",{className:_().header,children:[(0,s.jsx)("h1",{className:_().title,children:e("checkout.title")}),(0,s.jsx)(v.A,{steps:G,currentStep:M,onStepClick:e=>{let t=G.find(t=>t.id===e);(e<=M||t&&t.accessible)&&F(e)}})]}),(0,s.jsxs)("div",{className:_().content,children:[(0,s.jsxs)("div",{className:_().mainContent,children:["            ",1===M&&(0,s.jsx)(m.A,{checkoutData:H,updateCheckoutData:eo,errors:K,isAuthenticated:E,userAddresses:D,isLoadingAddresses:P,autoSaveInProgress:j,onLoadSavedAddress:e=>{L(e.id),W(t=>({...t,shipping_address:{street_address:e.street_address,apartment:e.address_line_2||"",city:e.city,state:e.state_province,postal_code:e.postal_code,country:e.country_code}}))},onDeleteAddress:er,selectedAddressId:q}),2===M&&(0,s.jsx)(g.A,{checkoutData:H,updateCheckoutData:eo,shippingMethods:Q,errors:K}),3===M&&(0,s.jsx)(k.A,{checkoutData:H,updateCheckoutData:eo,paymentMethods:d.u,errors:K,orderSummary:X}),"            ",4===M&&(0,s.jsx)(y.A,{checkoutData:H,orderSummary:X,onPlaceOrder:ei,isLoading:$}),"            ",M<4&&(0,s.jsxs)("div",{className:_().navigation,children:[M>1&&(0,s.jsx)("button",{type:"button",onClick:et,className:_().backButton,disabled:$,children:e("checkout.navigation.back")}),(0,s.jsx)("button",{type:"button",onClick:()=>{console.log("=== HANDLE CONTINUE CLICKED ==="),console.log("Current step:",M),console.log("Validation result:",es()),es()?1===M?(console.log("Step 1: Auto-saving address and moving to next step"),ea().then(()=>{ee()})):4===M?(console.log("Step 4: Starting order submission"),ei()):(console.log(`Step ${M}: Moving to next step`),ee()):console.log("Validation failed, errors:",K)},className:_().continueButton,disabled:$,children:$?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:_().spinner}),e("checkout.navigation.processing")]}):e("checkout.navigation.continue")})]}),4===M&&(0,s.jsx)("div",{className:_().navigation,children:(0,s.jsx)("button",{type:"button",onClick:et,className:_().backButton,disabled:$,children:e("checkout.navigation.back")})}),K.submit&&(0,s.jsx)("div",{className:_().errorMessage,children:K.submit})]}),"          ",(0,s.jsx)("div",{className:_().sidebar,children:(0,s.jsx)(f.A,{orderSummary:X,isLoading:$})})]})]})}):(0,s.jsxs)("div",{className:_().emptyCart,children:[(0,s.jsx)("h2",{children:e("checkout.emptyCart.title")}),(0,s.jsx)("p",{children:e("checkout.emptyCart.message")})]}):(0,s.jsx)("div",{className:_().checkoutPage,children:(0,s.jsx)("div",{className:_().container,children:(0,s.jsx)("div",{className:_().header,children:(0,s.jsx)("h1",{className:_().title,children:e("checkout.loading")})})})})}},42379:e=>{e.exports={checkoutPage:"checkout_checkoutPage__Oxt8U",container:"checkout_container__GDzOa",header:"checkout_header__ZlUxF",title:"checkout_title___IbnB",content:"checkout_content__zllQ3",mainContent:"checkout_mainContent__ecFbb",sidebar:"checkout_sidebar__7IEP5",navigation:"checkout_navigation__t7G5u",backButton:"checkout_backButton__ZIt2k",continueButton:"checkout_continueButton__jkgBp",spinner:"checkout_spinner__5GGpM",spin:"checkout_spin__sL5rA",errorMessage:"checkout_errorMessage__WSOsj",emptyCart:"checkout_emptyCart__aTX89"}},54787:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>s});let s=(0,o(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"c:\\\\Users\\\\alien\\\\Downloads\\\\Malikli-son - Preview\\\\frontend\\\\src\\\\app\\\\checkout\\\\page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"c:\\Users\\alien\\Downloads\\Malikli-son - Preview\\frontend\\src\\app\\checkout\\page.tsx","default")},68640:(e,t,o)=>{Promise.resolve().then(o.bind(o,30277))},83576:(e,t,o)=>{"use strict";o.r(t),o.d(t,{GlobalError:()=>i.a,__next_app__:()=>u,pages:()=>l,routeModule:()=>p,tree:()=>c});var s=o(65239),a=o(48088),r=o(88170),i=o.n(r),n=o(30893),d={};for(let e in n)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>n[e]);o.d(t,d);let c={children:["",{children:["checkout",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(o.bind(o,54787)),"c:\\Users\\alien\\Downloads\\Malikli-son - Preview\\frontend\\src\\app\\checkout\\page.tsx"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(o.bind(o,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(o.bind(o,38132)),"c:\\Users\\alien\\Downloads\\Malikli-son - Preview\\frontend\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(o.t.bind(o,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(o.t.bind(o,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(o.t.bind(o,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(o.bind(o,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,l=["c:\\Users\\alien\\Downloads\\Malikli-son - Preview\\frontend\\src\\app\\checkout\\page.tsx"],u={require:o,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/checkout/page",pathname:"/checkout",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})}};