"use strict";exports.id=8146,exports.ids=[8146],exports.modules={38516:(e,t,r)=>{r.d(t,{X:()=>s});var a=r(43210),o=r(54864),n=r(26335);let s=()=>{let e=(0,o.wA)();(0,a.useEffect)(()=>{e((0,n.Bb)())},[e]),(0,a.useEffect)(()=>{let t=t=>{("cart"===t.key||"cartId"===t.key)&&e((0,n.Bb)())};return window.addEventListener("storage",t),()=>{window.removeEventListener("storage",t)}},[e])}},45067:(e,t,r)=>{r.d(t,{C:()=>l,useI18n:()=>c});var a=r(60687),o=r(43210),n=r(47138),s=r(97992);let i=(0,o.createContext)(void 0),d={en:n,ru:s};function l({children:e}){let[t,r]=(0,o.useState)("en");return(0,a.jsx)(i.Provider,{value:{locale:t,setLocale:e=>{r(e),localStorage.setItem("locale",e),"undefined"!=typeof document&&(document.documentElement.lang=e)},t:(e,r)=>{let a=e.split("."),o=d[t];for(let t of a)if(!o||"object"!=typeof o)return e;else o=o[t];return"string"!=typeof o?e:r?o.replace(/\{\{(\w+)\}\}/g,(e,t)=>r[t]?.toString()||e):o},availableLocales:["en","ru"]},children:e})}function c(){let e=(0,o.useContext)(i);if(void 0===e)throw Error("useI18n must be used within an I18nProvider");return e}},72725:(e,t,r)=>{r.d(t,{FK:()=>o,It:()=>s,N4:()=>d,fS:()=>n,mK:()=>p,p:()=>i,u:()=>l});let a="http://localhost:8000/api/v1";async function o(e,t){let r=new URL(`${a}/orders/`);t&&(t.status&&"all"!==t.status&&r.searchParams.append("status",t.status),t.ordering&&r.searchParams.append("ordering",t.ordering),t.page&&r.searchParams.append("page",t.page.toString()),t.page_size&&r.searchParams.append("page_size",t.page_size.toString()));let o=await fetch(r.toString(),{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!o.ok){if(401===o.status)throw Error("Unauthorized - please log in again");throw Error(`Failed to fetch orders: ${o.statusText}`)}let n=await o.json();return{...n,results:n.results.map(u)}}async function n(e,t){console.log("=== CREATE ORDER API CALLED ==="),console.log("API URL:",`${a}/orders/create/`),console.log("Order data:",e),console.log("Token available:",!!t);let r=await fetch(`${a}/orders/create/`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(e)});if(console.log("=== CREATE ORDER RESPONSE ==="),console.log("Status:",r.status),console.log("Status text:",r.statusText),console.log("Response OK:",r.ok),!r.ok){let e=await r.json();throw console.error("=== CREATE ORDER ERROR RESPONSE ==="),console.error("Error data:",e),Error(e.message||"Failed to create order")}let o=await r.json();console.log("=== CREATE ORDER SUCCESS ==="),console.log("Backend order response:",o);let n=u(o);return console.log("Transformed order:",n),n}async function s(e,t,r){let o={"Content-Type":"application/json"};r&&(o.Authorization=`Bearer ${r}`);let n=await fetch(`${a}/orders/payment-callback/`,{method:"POST",headers:o,body:JSON.stringify({uid:e,status:"paid"===t?"success":"failed"})});if(!n.ok)throw Error((await n.json()).message||"Failed to update order payment status");if((await n.json()).success&&r)return i(String(e),r);throw Error("Payment status update failed")}async function i(e,t){let r=await fetch(`${a}/orders/${e}/`,{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(!r.ok){if(401===r.status)throw Error("Unauthorized - please log in again");if(404===r.status)throw Error("Order not found");throw Error(`Failed to fetch order: ${r.statusText}`)}return u(await r.json())}async function d(e,t){let r=await fetch(`${a}/orders/${e}/cancel/`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(!r.ok){if(401===r.status)throw Error("Unauthorized - please log in again");if(404===r.status)throw Error("Order not found");if(400===r.status)throw Error((await r.json()).detail||"Cannot cancel this order");throw Error(`Failed to cancel order: ${r.statusText}`)}return u(await r.json())}async function l(e,t){let r=await fetch(`${a}/orders/${e}/reorder/`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(!r.ok){if(401===r.status)throw Error("Unauthorized - please log in again");if(404===r.status)throw Error("Order not found");if(400===r.status)throw Error((await r.json()).detail||"Cannot reorder these items");throw Error(`Failed to reorder items: ${r.statusText}`)}return r.json()}function c(e){return{id:e.id,product_id:e.product_id,variant_id:e.variant_id,product_name:e.product_name,variant_name:e.variant_name,product_image:e.product_image,product_slug:e.product_slug,price:e.price,quantity:e.quantity,color:e.color,size:e.size,subtotal:e.subtotal,sku_snapshot:e.sku_snapshot,name:e.product_name,image:e.product_image||"/placeholder-product.png",variant:e.variant_name}}function u(e){console.log("Transforming backend order:",e);let t=e.shipping_address_details||e.shipping_address||{};return console.log("Shipping address details:",t),console.log("User fields from backend:",{user_first_name:e.user_first_name,user_last_name:e.user_last_name,user_email:e.user_email,user_phone:e.user_phone,email_for_guest:e.email_for_guest}),{id:e.order_id||e.id,order_number:e.order_number,status:({pending_payment:"pending",processing:"processing",shipped:"shipped",delivered:"delivered",cancelled:"cancelled",refunded:"cancelled",failed:"cancelled"})[e.order_status]||"pending",payment_status:({pending:"pending",paid:"paid",failed:"failed",refunded_partial:"refunded",refunded_full:"refunded"})[e.payment_status]||"pending",created_at:e.created_at,updated_at:e.updated_at,total_amount:e.total_amount,shipping_cost:e.shipping_cost,discount_amount:e.discount_amount,subtotal_amount:e.subtotal_amount,items:e.items?.map(c)||[],shipping_address:{first_name:t.recipient_name?.split(" ")[0]||t.first_name||"",last_name:t.recipient_name?.split(" ").slice(1).join(" ")||t.last_name||"",street_address:t.street_address||t.address_line_1||"",city:t.city||"",state:t.state_province||t.state||t.region||"",postal_code:t.postal_code||t.zip_code||"",country:t.country_code||t.country||"",phone:t.phone_number||t.phone||""},shipping_method:e.shipping_method_details?.name||e.shipping_method||"Standard",shipping_method_details:e.shipping_method_details,tracking_number:e.tracking_number,estimated_delivery:e.estimated_delivery,customer_info:{first_name:e.user_first_name||t.recipient_name?.split(" ")[0]||"",last_name:e.user_last_name||t.recipient_name?.split(" ").slice(1).join(" ")||"",email:e.user_email||e.email_for_guest||"",phone:e.user_phone||t.phone_number||""}}}async function p(e,t){console.log("=== CREATE DIRECT ORDER API CALLED ==="),console.log("API URL:",`${a}/orders/create-direct/`),console.log("Order data:",e),console.log("Token available:",!!t);let r={"Content-Type":"application/json"};t&&(r.Authorization=`Bearer ${t}`);let o=await fetch(`${a}/orders/create-direct/`,{method:"POST",headers:r,body:JSON.stringify(e)});if(console.log("=== CREATE DIRECT ORDER RESPONSE ==="),console.log("Status:",o.status),console.log("Status text:",o.statusText),console.log("Response OK:",o.ok),!o.ok){let e=await o.json();throw console.error("=== CREATE DIRECT ORDER ERROR RESPONSE ==="),console.error("Error data:",e),Error(e.message||"Failed to create direct order")}let n=await o.json();console.log("=== CREATE DIRECT ORDER SUCCESS ==="),console.log("Backend order response:",n);let s=u(n);return console.log("Transformed direct order:",s),s}},96203:(e,t,r)=>{r.d(t,{Z:()=>i});var a=r(43210),o=r(54864),n=r(26335);let s=()=>{let e=(0,o.d4)(e=>e.auth);return{user:e.user,isLoading:e.isLoading,isAuthenticated:e.isAuthenticated,token:e.token,error:e.error}},i=()=>{let e=(0,o.wA)(),{user:t,isLoading:r}=s(),{items:i,cartId:d,needsSync:l,isLoading:c,lastSyncTime:u}=(0,o.d4)(e=>e.cart);(0,a.useEffect)(()=>{r||(async()=>{if(t&&!c)if(d&&i.length>0)try{await new Promise(e=>setTimeout(e,100)),await e((0,n.sL)({guestCartId:d,strategy:"merge"})).unwrap()}catch(t){console.error("Failed to merge guest cart:",t),await e((0,n.tA)({}))}else await e((0,n.tA)({}));else if(!t&&i.length>0&&l)try{await e((0,n.So)()).unwrap()}catch(e){console.error("Failed to sync guest cart:",e)}})()},[t,r,e]),(0,a.useEffect)(()=>{if(l&&!c){let t=setTimeout(()=>{e((0,n.So)())},2e3);return()=>clearTimeout(t)}},[l,t,c,e]);let p=(0,a.useCallback)(async()=>{if(!c)try{t?await e((0,n.tA)({})).unwrap():await e((0,n.So)()).unwrap()}catch(e){throw console.error("Manual cart sync failed:",e),e}},[t,c,e]),g=(0,a.useCallback)(async(t="merge")=>{if(d&&!c)try{await e((0,n.sL)({guestCartId:d,strategy:t})).unwrap()}catch(e){throw console.error("Failed to merge guest cart:",e),e}},[d,c,e]);return{syncCart:p,mergeGuestCart:g,clearCartOnLogout:(0,a.useCallback)(()=>{e((0,n.sX)())},[e]),forceSyncCart:(0,a.useCallback)(async()=>{if(!c)try{await e((0,n.So)()).unwrap(),e((0,n.u$)())}catch(e){throw console.error("Force sync failed:",e),e}},[c,e]),isLoading:c,needsSync:l,lastSyncTime:u,cartId:d,isAuthenticated:!!t}}}};